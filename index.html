<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ì¶œê²° ê´€ë¦¬ ì‹œìŠ¤í…œ v2 (ë¯¸ì¸ì •ì§€ê° ê´€ë¦¬)</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>
    <style>
        body {
            font-family: Arial, sans-serif;
            margin: 0;
            padding: 15px;
            background-color: #f5f5f5;
            min-height: 100vh;
        }
        
        .header {
            background-color: white;
            padding: 10px 15px;
            border-radius: 6px;
            box-shadow: 0 1px 5px rgba(0,0,0,0.1);
            margin-bottom: 10px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        
        .header-left {
            display: flex;
            flex-direction: column;
            align-items: flex-start;
        }
        
        .header-right {
            display: flex;
            flex-wrap: wrap;
            gap: 6px;
            align-items: center;
        }
        
        .header h1 {
            margin: 0 0 4px 0;
            font-size: 20px;
        }
        
        .date-nav-container {
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 6px;
            margin: 4px 0;
        }
        
        .date-display {
            font-size: 14px;
            color: #007bff;
            margin: 0;
            min-width: 160px;
            text-align: center;
        }
        
        .date-nav-btn {
            background-color: #007bff;
            color: white;
            border: none;
            border-radius: 4px;
            padding: 5px 8px;
            cursor: pointer;
            font-size: 11px;
            transition: all 0.3s ease;
        }
        
        .date-nav-btn:hover {
            background-color: #0056b3;
        }
        
        .today-btn {
            margin-top: 5px;
        }
        
        .stats {
            display: grid;
            grid-template-columns: repeat(4, 1fr);
            gap: 20px;
            margin: 20px 0;
        }
        
        .stat-item {
            background-color: #f8f9fa;
            padding: 15px;
            border-radius: 8px;
            text-align: center;
            border-left: 4px solid;
        }
        
        .stat-item.present { border-left-color: #28a745; }
        .stat-item.absent { border-left-color: #dc3545; }
        .stat-item.late { border-left-color: #ffc107; }
        .stat-item.early { border-left-color: #17a2b8; }
        
        .stat-number {
            font-size: 24px;
            font-weight: bold;
            margin-bottom: 5px;
        }
        
        .stat-label {
            font-size: 14px;
            color: #666;
        }
        
        .main-container {
            display: grid;
            grid-template-columns: 1fr 370px;
            gap: 15px;
        }
        
        .left-panel {
            display: flex;
            flex-direction: column;
        }
        
        .right-panel {
            display: flex;
            flex-direction: column;
            gap: 15px;
        }
        
        
        .controls {
            background-color: white;
            padding: 15px;
            border-radius: 8px;
            box-shadow: 0 1px 5px rgba(0,0,0,0.1);
        }
        
        .controls h3 {
            margin: 0 0 15px 0;
            font-size: 16px;
        }
        
        .control-button {
            padding: 8px 14px;
            margin: 3px;
            border: none;
            border-radius: 6px;
            cursor: pointer;
            font-size: 13px;
            font-weight: bold;
            transition: all 0.3s ease;
            white-space: nowrap;
        }
        
        .export-btn { background-color: #28a745; color: white; }
        .export-btn:hover { background-color: #218838; }
        
        .history-btn { background-color: #007bff; color: white; }
        .history-btn:hover { background-color: #0056b3; }
        
        .reset-btn { background-color: #6c757d; color: white; }
        .reset-btn:hover { background-color: #5a6268; }
        
        .clear-all-btn { background-color: #dc3545; color: white; }
        .clear-all-btn:hover { background-color: #c82333; }

        .tab-btn {
            background-color: #6c757d;
            color: white;
            font-weight: bold;
        }

        .tab-btn:hover {
            background-color: #5a6268;
        }

        .tab-btn.active {
            background-color: #007bff;
            color: white;
        }
        
        /* ëˆ„ì ê¸°ë¡ ë²„íŠ¼ íŠ¹ë³„ ìŠ¤íƒ€ì¼ */
        .history-btn {
            background-color: #17a2b8 !important;
        }
        
        .history-btn:hover {
            background-color: #138496 !important;
        }

        .tab-content {
            display: none;
        }

        .tab-content.active {
            display: block;
        }

        .sms-container {
            padding: 20px;
            background-color: white;
            border-radius: 8px;
            box-shadow: 0 1px 5px rgba(0,0,0,0.1);
            margin: 15px;
        }

        .sms-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
            padding-bottom: 15px;
            border-bottom: 2px solid #dee2e6;
        }

        .sms-header h2 {
            margin: 0;
            color: #333;
        }

        .sms-controls {
            display: flex;
            gap: 10px;
        }

        .sms-table-container {
            overflow-x: auto;
            border: 1px solid #dee2e6;
            border-radius: 8px;
            max-height: 500px;
            overflow-y: auto;
        }

        .sms-table {
            width: 100%;
            border-collapse: collapse;
            font-size: 12px;
        }

        .sms-table th {
            background-color: #f8f9fa;
            padding: 12px 8px;
            text-align: center;
            font-weight: bold;
            border-bottom: 2px solid #dee2e6;
            border-right: 1px solid #dee2e6;
            color: #495057;
        }

        .sms-table th:last-child {
            border-right: none;
        }

        .sms-table td {
            padding: 10px 8px;
            text-align: center;
            border-bottom: 1px solid #dee2e6;
            border-right: 1px solid #dee2e6;
        }

        .sms-table td:last-child {
            border-right: none;
        }

        .sms-table tr:hover {
            background-color: #f8f9fa;
        }

        .sms-table tr.selected {
            background-color: #e3f2fd;
        }

        .sms-table .status-btn {
            border: none;
            padding: 6px 10px;
            border-radius: 4px;
            font-weight: bold;
            cursor: pointer;
            font-size: 11px;
            transition: all 0.3s ease;
            min-width: 80px;
        }

        .sms-table .status-btn:hover {
            transform: translateY(-1px);
            box-shadow: 0 2px 4px rgba(0,0,0,0.2);
        }

        .sms-table .status-btn.status-late, .sms-table .status-btn.status-unverified {
            background-color: #f8d7da;
            color: #721c24;
        }

        .sms-table .status-btn.status-late:hover, .sms-table .status-btn.status-unverified:hover {
            background-color: #f5c6cb;
        }

        .sms-table .status-btn.status-verified {
            background-color: #d1ecf1;
            color: #0c5460;
        }

        .sms-table .status-btn.status-verified:hover {
            background-color: #bee5eb;
        }

        .sms-table .status-btn.status-medical {
            background-color: #cce5ff;
            color: #004085;
        }

        .sms-table .status-btn.status-medical:hover {
            background-color: #b3d9ff;
        }

        .send-btn {
            background-color: #007bff;
            color: white;
            border: none;
            padding: 6px 12px;
            border-radius: 4px;
            font-weight: bold;
            cursor: pointer;
            font-size: 11px;
            transition: all 0.3s ease;
            min-width: 50px;
        }

        .send-btn:hover {
            background-color: #0056b3;
            transform: translateY(-1px);
            box-shadow: 0 2px 4px rgba(0,0,0,0.2);
        }

        .status-sent {
            background-color: #d4edda;
            color: #155724;
            padding: 4px 8px;
            border-radius: 4px;
            font-weight: bold;
        }

        .status-late, .status-unverified {
            background-color: #f8d7da;
            color: #721c24;
            padding: 4px 8px;
            border-radius: 4px;
            font-weight: bold;
        }

        .status-verified {
            background-color: #d1ecf1;
            color: #0c5460;
            padding: 4px 8px;
            border-radius: 4px;
            font-weight: bold;
        }

        .status-medical {
            background-color: #cce5ff;
            color: #004085;
            padding: 4px 8px;
            border-radius: 4px;
            font-weight: bold;
        }

        .template-tab {
            flex: 1;
            padding: 10px 15px;
            border: none;
            background-color: #f8f9fa;
            cursor: pointer;
            border-bottom: 2px solid transparent;
            transition: all 0.3s ease;
        }

        .template-tab:hover {
            background-color: #e9ecef;
        }

        .template-tab.active {
            background-color: white;
            border-bottom: 2px solid #007bff;
            color: #007bff;
            font-weight: bold;
        }

        .template-content {
            display: none;
            margin-bottom: 20px;
        }

        .template-content.active {
            display: block;
        }
        
        .calendar-section {
            background-color: white;
            padding: 15px;
            border-radius: 8px;
            box-shadow: 0 1px 5px rgba(0,0,0,0.1);
        }
        
        .calendar-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 10px;
        }
        
        .calendar-nav {
            display: flex;
            align-items: center;
            gap: 15px;
        }
        
        .day-nav {
            display: flex;
            align-items: center;
            gap: 8px;
        }
        
        .nav-btn {
            background-color: #007bff;
            color: white;
            border: none;
            border-radius: 4px;
            padding: 6px 10px;
            cursor: pointer;
            font-size: 12px;
            transition: all 0.3s ease;
        }
        
        .nav-btn:hover {
            background-color: #0056b3;
        }
        
        .calendar-title {
            font-size: 18px;
            font-weight: bold;
            color: #333;
            margin: 0;
        }
        
        .calendar-grid {
            display: grid;
            grid-template-columns: repeat(5, 1fr);
            gap: 3px;
            border: 1px solid #dee2e6;
            border-radius: 8px;
            overflow: hidden;
        }
        
        .calendar-day-header {
            background-color: #f8f9fa;
            padding: 12px;
            text-align: center;
            font-weight: bold;
            color: #495057;
            border-bottom: 1px solid #dee2e6;
        }
        
        .calendar-day {
            border: 1px solid #dee2e6;
            background-color: white;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: flex-start;
            padding: 8px 4px;
            cursor: pointer;
            transition: all 0.2s ease;
            min-height: 65px;
            font-size: 13px;
        }
        
        .calendar-day:hover {
            background-color: #f8f9fa;
        }
        
        .calendar-day.other-month {
            background-color: #f8f9fa;
            color: #6c757d;
        }
        
        .calendar-day.today {
            background-color: #e3f2fd;
            border: 2px solid #2196f3;
        }
        
        .calendar-day.selected {
            background-color: #007bff;
            color: white;
        }
        
        .day-number {
            font-weight: bold;
            margin-bottom: 4px;
            font-size: 16px;
        }
        
        .day-stats {
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 1px;
            font-size: 10px;
            width: 100%;
        }
        
        .stat-badge {
            display: block;
            padding: 2px 4px;
            border-radius: 4px;
            color: white;
            font-weight: bold;
            font-size: 9px;
            text-align: center;
            margin: 1px 0;
            max-width: 100%;
            overflow: hidden;
            white-space: nowrap;
            text-overflow: ellipsis;
            cursor: help;
        }
        
        .stat-badge.absent { background-color: #dc3545; }
        .stat-badge.late { background-color: #ffc107; color: #212529; }
        .stat-badge.early { background-color: #17a2b8; }
        
        .student-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(140px, 1fr));
            gap: 10px;
            background-color: white;
            padding: 15px;
            border-radius: 8px;
            box-shadow: 0 1px 5px rgba(0,0,0,0.1);
        }
        
        .student-card {
            border: 2px solid #ddd;
            border-radius: 8px;
            padding: 10px;
            background-color: #f8f9fa;
            text-align: center;
            transition: all 0.3s ease;
        }
        
        .student-card.absent {
            background-color: #f8d7da;
            border-color: #dc3545;
        }
        
        .student-card.late {
            background-color: #fff3cd;
            border-color: #ffc107;
        }
        
        .student-card.early-leave {
            background-color: #d1ecf1;
            border-color: #17a2b8;
        }
        
        .student-card.absent .student-number,
        .student-card.late .student-number,
        .student-card.early-leave .student-number {
            color: #333;
        }
        
        .student-header {
            display: flex;
            align-items: center;
            justify-content: space-between;
            margin-bottom: 8px;
            min-height: 20px;
        }
        
        .student-number {
            font-size: 16px;
            font-weight: bold;
            color: #999;
            transition: color 0.3s ease;
        }
        
        .student-status {
            font-size: 10px;
            color: #666;
            min-width: 30px;
            text-align: left;
        }
        
        .button-group {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 3px;
        }
        
        .status-btn {
            padding: 4px 6px;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            font-size: 10px;
            font-weight: bold;
            transition: all 0.2s ease;
        }
        
        .btn-absent {
            background-color: #dc3545;
            color: white;
        }
        
        .btn-absent:hover {
            background-color: #c82333;
        }
        
        .btn-late {
            background-color: #ffc107;
            color: #212529;
        }
        
        .btn-late:hover {
            background-color: #e0a800;
        }
        
        .btn-early {
            background-color: #17a2b8;
            color: white;
        }
        
        .btn-early:hover {
            background-color: #138496;
        }
        
        .btn-absent-early {
            background-color: #6c757d;
            color: white;
        }
        
        .btn-absent-early:hover {
            background-color: #5a6268;
        }
        
        .btn-clear {
            background-color: #6c757d;
            color: white;
        }
        
        .btn-clear:hover {
            background-color: #5a6268;
        }
        
        
        .modal {
            display: none;
            position: fixed;
            z-index: 1000;
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0,0,0,0.5);
        }
        
        .modal-content {
            background-color: white;
            margin: 5% auto;
            padding: 30px;
            border-radius: 10px;
            width: 80%;
            max-width: 600px;
            max-height: 80vh;
            overflow-y: auto;
        }
        
        .close {
            color: #aaa;
            float: right;
            font-size: 28px;
            font-weight: bold;
            cursor: pointer;
        }
        
        .close:hover {
            color: #000;
        }
        
        .period-modal {
            max-width: 400px;
            text-align: center;
        }
        
        .period-modal h3 {
            margin: 0 0 20px 0;
            font-size: 18px;
            color: #333;
        }
        
        .period-grid {
            display: grid;
            grid-template-columns: repeat(4, 1fr);
            gap: 10px;
        }
        
        .period-btn {
            padding: 15px 10px;
            border: 2px solid #007bff;
            border-radius: 8px;
            background-color: white;
            color: #007bff;
            cursor: pointer;
            font-size: 14px;
            font-weight: bold;
            transition: all 0.3s ease;
        }
        
        .period-btn:hover {
            background-color: #007bff;
            color: white;
        }
        
        .period-btn.cancel-btn {
            grid-column: span 4;
            background-color: #6c757d;
            border-color: #6c757d;
            color: white;
        }
        
        .period-btn.cancel-btn:hover {
            background-color: #5a6268;
            border-color: #545b62;
        }
        
        /* ë²”ìœ„ ì„ íƒì„ ìœ„í•œ ìƒˆë¡œìš´ ìŠ¤íƒ€ì¼ */
        .period-btn.start-selected {
            background-color: #007bff;
            color: white;
            border-color: #007bff;
        }
        
        .period-btn.end-selected {
            background-color: #dc3545;
            color: white;
            border-color: #dc3545;
        }
        
        .period-btn.in-range {
            background-color: #e9ecef;
            color: #495057;
            border-color: #ced4da;
        }
        
        .period-btn.start-selected::after {
            content: " (ì‹œì‘)";
            font-size: 12px;
        }
        
        .period-btn.end-selected::after {
            content: " (ë)";
            font-size: 12px;
        }

        .month-btn {
            padding: 8px 12px;
            border: 1px solid #007bff;
            border-radius: 4px;
            background-color: white;
            color: #007bff;
            cursor: pointer;
            font-size: 12px;
            font-weight: bold;
            transition: all 0.3s ease;
            text-align: center;
        }

        .month-btn:hover {
            background-color: #007bff;
            color: white;
        }

        .month-btn.active {
            background-color: #007bff;
            color: white;
        }

        .month-btn:disabled {
            background-color: #f8f9fa !important;
            color: #6c757d !important;
            border-color: #dee2e6 !important;
            cursor: not-allowed !important;
            pointer-events: none !important;
        }
        
        .modal-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
        }
        
        .modal-header h2 {
            margin: 0;
        }
        
        /* í”„ë¦°íŠ¸ ì „ìš© ìŠ¤íƒ€ì¼ */
        @media print {
            body * {
                visibility: hidden;
            }
            
            #historyModal, #historyModal * {
                visibility: visible;
            }
            
            #historyModal {
                position: absolute;
                left: 0;
                top: 0;
                width: 100%;
                height: 100%;
                background-color: white !important;
                margin: 0;
                padding: 20px;
                box-sizing: border-box;
            }
            
            .modal-content {
                width: 100% !important;
                max-width: none !important;
                margin: 0 !important;
                padding: 0 !important;
                box-shadow: none !important;
                border-radius: 0 !important;
                max-height: none !important;
                overflow: visible !important;
            }
            
            .close, .control-button {
                display: none !important;
            }
            
            .modal-header {
                border-bottom: 2px solid #333;
                padding-bottom: 10px;
                margin-bottom: 20px;
            }
            
            .modal-header h2 {
                color: #333 !important;
                font-size: 24px !important;
            }
        }
        
        /* ë°˜ì‘í˜• ë””ìì¸ */
        @media (max-width: 1200px) {
            .main-container {
                grid-template-columns: 1fr;
            }
            
            .student-grid {
                grid-template-columns: repeat(auto-fit, minmax(120px, 1fr));
            }
            
            .header {
                flex-direction: column;
                gap: 15px;
            }
            
            .header-right {
                justify-content: center;
            }
        }
        
        @media (max-width: 768px) {
            body {
                padding: 10px;
            }
            
            .student-grid {
                grid-template-columns: repeat(auto-fit, minmax(100px, 1fr));
                gap: 8px;
            }
            
            .calendar-day {
                min-height: 50px;
                font-size: 12px;
            }
            
            .day-number {
                font-size: 14px;
            }
            
            .header-right {
                flex-direction: column;
                gap: 8px;
            }
            
            .control-button {
                width: 100%;
                text-align: center;
            }
        }
    </style>
</head>
<body>
    <div class="header">
        <div class="header-left">
            <h1>ğŸ“‹ ì¶œê²° ê´€ë¦¬ ì‹œìŠ¤í…œ v2</h1>
            <div class="date-nav-container">
                <button class="date-nav-btn" onclick="changeWorkingDate(-1)">â—€</button>
                <div class="date-display" id="workingDate"></div>
                <button class="date-nav-btn" onclick="changeWorkingDate(1)">â–¶</button>
                <button class="date-nav-btn today-btn" onclick="goToWorkingToday()">ì˜¤ëŠ˜ë¡œ</button>
            </div>
        </div>
        <div class="header-right">
            <button class="control-button tab-btn" onclick="switchTab('attendance')" id="attendance-tab">ğŸ“‹ ì¶œê²°ê´€ë¦¬</button>
            <button class="control-button tab-btn" onclick="switchTab('sms')" id="sms-tab">ğŸ“± ë¬¸ìë°œì†¡</button>
            <button class="control-button history-btn" onclick="showHistory()">ğŸ“š ëˆ„ì  ê¸°ë¡</button>
            <button class="control-button export-btn" onclick="exportAllToCSV()">ğŸ“Š ì „ì²´ ë‚´ë³´ë‚´ê¸°</button>
            <button class="control-button clear-all-btn" onclick="resetAllData()">ğŸ—‘ï¸ ëª¨ë‘ ì´ˆê¸°í™”</button>
        </div>
    </div>
    
    <!-- ì¶œê²°ê´€ë¦¬ íƒ­ -->
    <div id="attendance-content" class="tab-content active">
        <div class="main-container">
            <div class="left-panel">
                <div class="student-grid" id="studentGrid">
                    <!-- í•™ìƒ ì¹´ë“œë“¤ì´ ì—¬ê¸°ì— ìƒì„±ë©ë‹ˆë‹¤ -->
                </div>
            </div>
            
            <div class="right-panel">
                <div class="calendar-section">
                    <div class="calendar-header">
                        <div class="calendar-nav">
                            <button class="nav-btn" onclick="changeMonth(-1)">â—€ ì´ì „</button>
                            <h2 class="calendar-title" id="calendarTitle"></h2>
                            <button class="nav-btn" onclick="changeMonth(1)">ë‹¤ìŒ â–¶</button>
                        </div>
                        <button class="nav-btn" onclick="goToToday()">ì˜¤ëŠ˜</button>
                    </div>
                </div>
                
                <div class="calendar-grid" id="calendarGrid">
                    <!-- ë‹¬ë ¥ì´ ì—¬ê¸°ì— ìƒì„±ë©ë‹ˆë‹¤ -->
                </div>
            </div>
        </div>
    </div>

    <!-- ë¬¸ìë°œì†¡ íƒ­ -->
    <div id="sms-content" class="tab-content">
        <div class="sms-container">
            <div class="sms-header">
                <h2>ğŸ“± ë¬¸ìë°œì†¡ ê´€ë¦¬</h2>
                <div class="sms-controls">
                    <button class="control-button reset-btn" onclick="uploadStudentData()">ğŸ“¤ í•™ìƒëª…ë‹¨ ê´€ë¦¬</button>
                    <button class="control-button reset-btn" onclick="setWebhookUrl()">âš™ï¸ ì†”ë¼í”¼ ì„¤ì •</button>
                    <button class="control-button reset-btn" onclick="setSMSTemplate()">ğŸ“ í…œí”Œë¦¿ ì„¤ì •</button>
                </div>
            </div>
            
            <div class="sms-table-container">
                <table class="sms-table" id="smsTable">
                    <thead>
                        <tr>
                            <th width="60">ë²ˆí˜¸</th>
                            <th width="80">ì´ë¦„</th>
                            <th width="120">ë³´í˜¸ì ì „í™”ë²ˆí˜¸</th>
                            <th width="100">ë‚ ì§œ</th>
                            <th width="80">ìƒíƒœ</th>
                            <th width="80">ì¢…ë¥˜</th>
                            <th width="80">ì‹œì‘êµì‹œ</th>
                            <th width="80">ëêµì‹œ</th>
                            <th width="80">ë°œì†¡</th>
                            <th width="100">ë°œì†¡ì™„ë£Œ</th>
                        </tr>
                    </thead>
                    <tbody id="smsTableBody">
                        <!-- ë¬¸ìë°œì†¡ ëª©ë¡ì´ ì—¬ê¸°ì— ìƒì„±ë©ë‹ˆë‹¤ -->
                    </tbody>
                </table>
            </div>
        </div>
    </div>

    <!-- ëˆ„ì  ê¸°ë¡ ëª¨ë‹¬ -->
    <div id="historyModal" class="modal">
        <div class="modal-content">
            <span class="close" onclick="closeHistory()">&times;</span>
            <div class="modal-header">
                <h2>ğŸ“š ëˆ„ì  ì¶œê²° ê¸°ë¡</h2>
                <div style="display: flex; gap: 10px; align-items: center;">
                    <button class="control-button history-btn" onclick="filterByMonth('')" id="btn-all">ì „ì²´</button>
                    <button class="control-button history-btn" onclick="showMonthSelector()">ì›”ë³„</button>
                    <button class="control-button export-btn" onclick="printHistory()">ğŸ“„ í”„ë¦°íŠ¸</button>
                </div>
            </div>
            <div id="historyContent">
                <!-- ëˆ„ì  ê¸°ë¡ì´ ì—¬ê¸°ì— í‘œì‹œë©ë‹ˆë‹¤ -->
            </div>
        </div>
    </div>

    <!-- êµì‹œ ì„ íƒ ëª¨ë‹¬ -->
    <div id="periodModal" class="modal">
        <div class="modal-content period-modal">
            <h3 id="periodModalTitle">ì‹œì‘ êµì‹œë¥¼ ì„ íƒí•˜ì„¸ìš”</h3>
            <p id="periodModalSubtitle" style="font-size: 14px; color: #666; margin: 5px 0 15px 0;"></p>
            <div class="period-grid">
                <button class="period-btn" id="period-0" onclick="selectPeriodRange(0)">ì¡°ë¡€</button>
                <button class="period-btn" id="period-1" onclick="selectPeriodRange(1)">1êµì‹œ</button>
                <button class="period-btn" id="period-2" onclick="selectPeriodRange(2)">2êµì‹œ</button>
                <button class="period-btn" id="period-3" onclick="selectPeriodRange(3)">3êµì‹œ</button>
                <button class="period-btn" id="period-4" onclick="selectPeriodRange(4)">4êµì‹œ</button>
                <button class="period-btn" id="period-5" onclick="selectPeriodRange(5)">5êµì‹œ</button>
                <button class="period-btn" id="period-6" onclick="selectPeriodRange(6)">6êµì‹œ</button>
                <button class="period-btn" id="period-7" onclick="selectPeriodRange(7)">7êµì‹œ</button>
            </div>
            <div style="margin-top: 15px; text-align: center;">
                <button class="period-btn cancel-btn" onclick="resetPeriodSelection()" style="background-color: #ffc107; margin-right: 10px;">ì´ˆê¸°í™”</button>
                <button class="period-btn cancel-btn" onclick="closePeriodModal()">ì·¨ì†Œ</button>
            </div>
        </div>
    </div>

    <!-- v2 ìƒˆ ê¸°ëŠ¥: ì¶œì„ ìƒíƒœ ì„ íƒ ëª¨ë‹¬ -->
    <div id="attendanceModal" class="modal">
        <div class="modal-content period-modal">
            <h3 id="attendanceModalTitle">ì¶œì„ ìœ í˜•ì„ ì„ íƒí•˜ì„¸ìš”</h3>
            <div class="period-grid" style="grid-template-columns: 1fr 1fr 1fr;">
                <button class="period-btn" onclick="selectAttendanceType('medical')" style="background-color: #17a2b8; color: white;">
                    ğŸ¥ ì§ˆë³‘
                </button>
                <button class="period-btn" onclick="selectAttendanceType('verified')" style="background-color: #28a745; color: white;">
                    âœ“ ì¸ì •
                </button>
                <button class="period-btn" onclick="selectAttendanceType('unverified')" style="background-color: #dc3545; color: white;">
                    âœ— ë¯¸ì¸ì •  
                </button>
                <button class="period-btn cancel-btn" onclick="closeAttendanceModal()">ì·¨ì†Œ</button>
            </div>
        </div>
    </div>

    <!-- SMS ë¯¸ë¦¬ë³´ê¸° ëª¨ë‹¬ -->
    <div id="smsPreviewModal" class="modal">
        <div class="modal-content">
            <span class="close" onclick="closeSMSPreview()">&times;</span>
            <div class="modal-header">
                <h2>ğŸ“± ë¬¸ì ë¯¸ë¦¬ë³´ê¸°</h2>
            </div>
            <div style="padding: 20px;">
                <div style="background: #f8f9fa; padding: 15px; border-radius: 8px; margin-bottom: 20px;">
                    <div style="font-weight: bold; margin-bottom: 10px;">ë°›ëŠ” ì‚¬ëŒ: <span id="previewRecipient"></span></div>
                    <div style="font-weight: bold; margin-bottom: 10px;">ì—°ë½ì²˜: <span id="previewPhone"></span></div>
                    <div style="font-weight: bold; margin-bottom: 10px;">ë°œì‹ ì: <span id="previewSender"></span></div>
                </div>
                <div style="background: white; border: 2px solid #007bff; border-radius: 8px; padding: 15px; min-height: 150px; font-family: monospace; white-space: pre-line;" id="previewMessage"></div>
                <div style="text-align: center; margin-top: 20px;">
                    <button class="control-button" onclick="confirmSendSMS()" style="background-color: #28a745; margin-right: 10px;">âœ… ë°œì†¡í•˜ê¸°</button>
                    <button class="control-button" onclick="closeSMSPreview()" style="background-color: #6c757d;">âŒ ì·¨ì†Œ</button>
                </div>
            </div>
        </div>
    </div>

    <!-- ì›” ì„ íƒ ëª¨ë‹¬ -->
    <div id="monthSelectorModal" class="modal">
        <div class="modal-content period-modal">
            <h3>ì›”ì„ ì„ íƒí•˜ì„¸ìš”</h3>
            <div class="period-grid" style="grid-template-columns: repeat(4, 1fr);">
                <button class="month-btn" onclick="selectMonth('01')" id="month-1">1ì›”</button>
                <button class="month-btn" onclick="selectMonth('02')" id="month-2">2ì›”</button>
                <button class="month-btn" onclick="selectMonth('03')" id="month-3">3ì›”</button>
                <button class="month-btn" onclick="selectMonth('04')" id="month-4">4ì›”</button>
                <button class="month-btn" onclick="selectMonth('05')" id="month-5">5ì›”</button>
                <button class="month-btn" onclick="selectMonth('06')" id="month-6">6ì›”</button>
                <button class="month-btn" onclick="selectMonth('07')" id="month-7">7ì›”</button>
                <button class="month-btn" onclick="selectMonth('08')" id="month-8">8ì›”</button>
                <button class="month-btn" onclick="selectMonth('09')" id="month-9">9ì›”</button>
                <button class="month-btn" onclick="selectMonth('10')" id="month-10">10ì›”</button>
                <button class="month-btn" onclick="selectMonth('11')" id="month-11">11ì›”</button>
                <button class="month-btn" onclick="selectMonth('12')" id="month-12">12ì›”</button>
                <button class="period-btn cancel-btn" onclick="closeMonthSelector()">ì·¨ì†Œ</button>
            </div>
        </div>
    </div>

    <!-- í•™ìƒëª…ë‹¨ ì—…ë¡œë“œ ëª¨ë‹¬ -->
    <div id="studentUploadModal" class="modal">
        <div class="modal-content">
            <span class="close" onclick="closeStudentUploadModal()">&times;</span>
            <div class="modal-header">
                <h2>ğŸ‘¥ í•™ìƒëª…ë‹¨ ê´€ë¦¬</h2>
            </div>
            <div style="padding: 20px;">
                <div style="margin-bottom: 20px;">
                    <h3>ğŸ“¥ 1ë‹¨ê³„: ì–‘ì‹ ë‹¤ìš´ë¡œë“œ</h3>
                    <p>ë¨¼ì € í•™ìƒëª…ë‹¨ ì–‘ì‹ì„ ë‹¤ìš´ë¡œë“œí•˜ì„¸ìš”.</p>
                    <button class="control-button" onclick="downloadStudentTemplate()" style="background-color: #17a2b8;">ğŸ“¥ í•™ìƒëª…ë‹¨ ì–‘ì‹ ë‹¤ìš´ë¡œë“œ</button>
                </div>
                
                <div style="margin-bottom: 20px;">
                    <h3>ğŸ“ 2ë‹¨ê³„: ì–‘ì‹ ì‘ì„±</h3>
                    <p>ë‹¤ìš´ë¡œë“œí•œ CSV íŒŒì¼ì„ ì—´ì–´ì„œ í•™ìƒ ì •ë³´ë¥¼ ì…ë ¥í•˜ì„¸ìš”.</p>
                    <ul style="margin: 10px 0; padding-left: 20px;">
                        <li>ë²ˆí˜¸: í•™ìƒ ë²ˆí˜¸ (ìˆ«ì)</li>
                        <li>ì´ë¦„: í•™ìƒ ì´ë¦„</li>
                        <li>ì „í™”ë²ˆí˜¸: ì—°ë½ì²˜ (010-0000-0000 í˜•ì‹)</li>
                    </ul>
                </div>
                
                <div style="margin-bottom: 20px;">
                    <h3>ğŸ“¤ 3ë‹¨ê³„: íŒŒì¼ ì—…ë¡œë“œ</h3>
                    <input type="file" id="studentFileInput" accept=".csv,.xls,.xlsx,application/vnd.ms-excel,application/vnd.openxmlformats-officedocument.spreadsheetml.sheet" style="margin-bottom: 10px;">
                    <br>
                    <button class="control-button" onclick="processStudentFile()" style="background-color: #28a745;">ğŸ“¤ í•™ìƒëª…ë‹¨ ì—…ë¡œë“œ</button>
                </div>
                
                <div id="uploadResult" style="margin-top: 20px; padding: 10px; border-radius: 4px; display: none;"></div>
            </div>
        </div>
    </div>

    <!-- ë¬¸ì í…œí”Œë¦¿ ì„¤ì • ëª¨ë‹¬ -->
    <div id="templateModal" class="modal">
        <div class="modal-content">
            <span class="close" onclick="closeTemplateModal()">&times;</span>
            <div class="modal-header">
                <h2>ğŸ“ ë¬¸ì í…œí”Œë¦¿ ì„¤ì •</h2>
            </div>
            <div style="margin-bottom: 20px;">
                <h4>ì‚¬ìš© ê°€ëŠ¥í•œ ë³€ìˆ˜:</h4>
                <p style="background-color: #f8f9fa; padding: 10px; border-radius: 4px; font-size: 12px;">
                    {{ì´ë¦„}} - í•™ìƒ ì´ë¦„<br>
                    {{ë‚ ì§œ}} - ì¶œê²° ë‚ ì§œ<br>
                    {{ì¢…ë¥˜}} - ì¶œê²° ìƒíƒœ (ë¯¸ì¸ì •ê²°ì„, ì¸ì •ì§€ê° ë“±)<br>
                    {{ë°œì‹ ìëª…}} - ë°œì‹ ì ì´ë¦„<br>
                    {{ì‹œì‘}} - ì‹œì‘ êµì‹œ<br>
                    {{ë}} - ì¢…ë£Œ êµì‹œ
                </p>
            </div>
            <div style="margin-bottom: 15px;">
                <label for="senderName" style="display: block; margin-bottom: 5px; font-weight: bold;">ë°œì‹ ìëª…:</label>
                <input type="text" id="senderName" placeholder="ì˜ˆ: 3-2ë°˜ ë‹´ì„" style="width: 100%; padding: 8px; border: 1px solid #ddd; border-radius: 4px;">
            </div>
            
            <!-- í…œí”Œë¦¿ íƒ­ ë²„íŠ¼ -->
            <div style="margin-bottom: 15px;">
                <div style="display: flex; border-bottom: 1px solid #ddd;">
                    <button type="button" class="template-tab active" onclick="switchTemplateTab('absent')" id="tab-absent">ê²°ì„ í…œí”Œë¦¿</button>
                    <button type="button" class="template-tab" onclick="switchTemplateTab('late')" id="tab-late">ì§€ê° í…œí”Œë¦¿</button>
                    <button type="button" class="template-tab" onclick="switchTemplateTab('early')" id="tab-early">ì¡°í‡´ í…œí”Œë¦¿</button>
                    <button type="button" class="template-tab" onclick="switchTemplateTab('absent-early')" id="tab-absent-early">ê²°ê³¼ í…œí”Œë¦¿</button>
                </div>
            </div>
            
            <!-- ê²°ì„ í…œí”Œë¦¿ -->
            <div id="template-absent" class="template-content active">
                <label style="display: block; margin-bottom: 5px; font-weight: bold;">ê²°ì„ ë¬¸ì í…œí”Œë¦¿:</label>
                <textarea id="templateAbsent" rows="10" style="width: 100%; padding: 10px; border: 1px solid #ddd; border-radius: 4px; font-family: inherit; resize: vertical;"></textarea>
            </div>
            
            <!-- ì§€ê° í…œí”Œë¦¿ -->
            <div id="template-late" class="template-content">
                <label style="display: block; margin-bottom: 5px; font-weight: bold;">ì§€ê° ë¬¸ì í…œí”Œë¦¿:</label>
                <textarea id="templateLate" rows="10" style="width: 100%; padding: 10px; border: 1px solid #ddd; border-radius: 4px; font-family: inherit; resize: vertical;"></textarea>
            </div>
            
            <!-- ì¡°í‡´ í…œí”Œë¦¿ -->
            <div id="template-early" class="template-content">
                <label style="display: block; margin-bottom: 5px; font-weight: bold;">ì¡°í‡´ ë¬¸ì í…œí”Œë¦¿:</label>
                <textarea id="templateEarly" rows="10" style="width: 100%; padding: 10px; border: 1px solid #ddd; border-radius: 4px; font-family: inherit; resize: vertical;"></textarea>
            </div>
            
            <!-- ê²°ê³¼ í…œí”Œë¦¿ -->
            <div id="template-absent-early" class="template-content">
                <label style="display: block; margin-bottom: 5px; font-weight: bold;">ê²°ê³¼ ë¬¸ì í…œí”Œë¦¿:</label>
                <textarea id="templateAbsentEarly" rows="10" style="width: 100%; padding: 10px; border: 1px solid #ddd; border-radius: 4px; font-family: inherit; resize: vertical;"></textarea>
            </div>
            <div style="text-align: right;">
                <button class="control-button reset-btn" onclick="resetTemplate()">ê¸°ë³¸ê°’ ë³µì›</button>
                <button class="control-button export-btn" onclick="saveTemplate()">ì €ì¥</button>
            </div>
        </div>
    </div>

    <script>
        let todayAttendance = {};
        let allRecords = {}; // ë‚ ì§œë³„ ëˆ„ì  ê¸°ë¡
        let currentDate = new Date();
        let selectedDate = new Date();
        let workingDate = new Date(); // í˜„ì¬ ì‘ì—… ì¤‘ì¸ ë‚ ì§œ
        let pendingStudent = null; // êµì‹œ ì„ íƒ ëŒ€ê¸° ì¤‘ì¸ í•™ìƒ
        let pendingStatus = null; // êµì‹œ ì„ íƒ ëŒ€ê¸° ì¤‘ì¸ ìƒíƒœ
        let pendingVerificationType = null; // v2: ì¸ì •/ë¯¸ì¸ì •/ë³‘ê²° ëŒ€ê¸° ì¤‘
        
        // ì‘ì—… ë‚ ì§œ í‘œì‹œ
        function displayWorkingDate() {
            const dateString = workingDate.toLocaleDateString('ko-KR', {
                year: 'numeric',
                month: 'long',
                day: 'numeric',
                weekday: 'long'
            });
            document.getElementById('workingDate').textContent = dateString;
        }
        
        // ë‹¬ë ¥ ìƒì„±
        function createCalendar() {
            const calendarGrid = document.getElementById('calendarGrid');
            const calendarTitle = document.getElementById('calendarTitle');
            
            // ì›”/ë…„ ì œëª© ì„¤ì •
            const monthNames = ['1ì›”', '2ì›”', '3ì›”', '4ì›”', '5ì›”', '6ì›”', 
                               '7ì›”', '8ì›”', '9ì›”', '10ì›”', '11ì›”', '12ì›”'];
            calendarTitle.textContent = `${currentDate.getFullYear()}ë…„ ${monthNames[currentDate.getMonth()]}`;
            
            // ë‹¬ë ¥ ê·¸ë¦¬ë“œ ì´ˆê¸°í™”
            calendarGrid.innerHTML = '';
            
            // ìš”ì¼ í—¤ë” ì¶”ê°€ (í‰ì¼ë§Œ)
            const dayHeaders = ['ì›”', 'í™”', 'ìˆ˜', 'ëª©', 'ê¸ˆ'];
            dayHeaders.forEach(day => {
                const header = document.createElement('div');
                header.className = 'calendar-day-header';
                header.textContent = day;
                calendarGrid.appendChild(header);
            });
            
            // ë‹¬ì˜ ì²«ì§¸ ë‚ ê³¼ ë§ˆì§€ë§‰ ë‚  ê³„ì‚°
            const firstDay = new Date(currentDate.getFullYear(), currentDate.getMonth(), 1);
            const lastDay = new Date(currentDate.getFullYear(), currentDate.getMonth() + 1, 0);
            
            // í•´ë‹¹ ì›”ì˜ ëª¨ë“  ë‚ ì§œë¥¼ ìˆ˜ì§‘í•˜ê³  í‰ì¼ë§Œ í•„í„°ë§
            const weekdays = [];
            for (let day = 1; day <= lastDay.getDate(); day++) {
                const date = new Date(currentDate.getFullYear(), currentDate.getMonth(), day);
                const dayOfWeek = date.getDay(); // 0: ì¼ìš”ì¼, 1: ì›”ìš”ì¼, ..., 6: í† ìš”ì¼
                
                // í‰ì¼ë§Œ í¬í•¨ (ì›”~ê¸ˆ: 1~5)
                if (dayOfWeek >= 1 && dayOfWeek <= 5) {
                    weekdays.push(date);
                }
            }
            
            // ì´ì „ ë‹¬ì˜ í‰ì¼ë“¤ë„ í•„ìš”í•˜ë©´ ì¶”ê°€ (ì²« ì£¼ê°€ ë¹„ì–´ìˆì„ ê²½ìš°)
            const firstWeekday = firstDay.getDay();
            if (firstWeekday > 1) { // ì›”ìš”ì¼(1)ì´ ì•„ë‹Œ ê²½ìš°
                const prevMonth = new Date(currentDate.getFullYear(), currentDate.getMonth(), 0);
                for (let i = firstWeekday - 1; i >= 1; i--) {
                    const date = new Date(prevMonth.getFullYear(), prevMonth.getMonth(), prevMonth.getDate() - (firstWeekday - 1 - i));
                    if (date.getDay() >= 1 && date.getDay() <= 5) {
                        weekdays.unshift(date);
                    }
                }
            }
            
            // ë‹¤ìŒ ë‹¬ì˜ í‰ì¼ë“¤ë„ í•„ìš”í•˜ë©´ ì¶”ê°€ (ë§ˆì§€ë§‰ ì£¼ê°€ ë¹„ì–´ìˆì„ ê²½ìš°)
            const totalDays = weekdays.length;
            const weeksNeeded = Math.ceil(totalDays / 5);
            const totalCells = weeksNeeded * 5;
            
            if (totalDays < totalCells) {
                const nextMonth = new Date(currentDate.getFullYear(), currentDate.getMonth() + 1, 1);
                let day = 1;
                while (weekdays.length < totalCells) {
                    const date = new Date(nextMonth.getFullYear(), nextMonth.getMonth(), day);
                    if (date.getDay() >= 1 && date.getDay() <= 5) {
                        weekdays.push(date);
                    }
                    day++;
                }
            }
            
            // í‰ì¼ë“¤ë§Œ ë‹¬ë ¥ì— í‘œì‹œ
            weekdays.forEach(date => {
                const dayElement = document.createElement('div');
                dayElement.className = 'calendar-day';
                
                // ë‹¤ë¥¸ ë‹¬ì¸ì§€ í™•ì¸
                if (date.getMonth() !== currentDate.getMonth()) {
                    dayElement.classList.add('other-month');
                }
                
                // ì˜¤ëŠ˜ì¸ì§€ í™•ì¸
                const today = new Date();
                if (date.toDateString() === today.toDateString()) {
                    dayElement.classList.add('today');
                }
                
                // ì„ íƒëœ ë‚ ì§œì¸ì§€ í™•ì¸
                if (date.toDateString() === selectedDate.toDateString()) {
                    dayElement.classList.add('selected');
                }
                
                // ë‚ ì§œ í´ë¦­ ì´ë²¤íŠ¸
                dayElement.onclick = () => selectDate(date);
                
                // ë‚ ì§œ ë²ˆí˜¸
                const dayNumber = document.createElement('div');
                dayNumber.className = 'day-number';
                dayNumber.textContent = date.getDate();
                dayElement.appendChild(dayNumber);
                
                // í•´ë‹¹ ë‚ ì§œì˜ ì¶œê²° í•™ìƒ ë²ˆí˜¸ í‘œì‹œ
                const dateKey = date.toLocaleDateString('ko-KR');
                if (allRecords[dateKey]) {
                    const dayStats = document.createElement('div');
                    dayStats.className = 'day-stats';
                    
                    const studentsByStatus = getStudentsByStatus(allRecords[dateKey]);
                    
                    // ê²°ì„ í•™ìƒ ë²ˆí˜¸ë“¤
                    if (studentsByStatus.absent.length > 0) {
                        const badge = document.createElement('span');
                        badge.className = 'stat-badge absent';
                        const sortedNumbers = studentsByStatus.absent.sort((a, b) => a - b);
                        const displayText = getDisplayText(sortedNumbers);
                        badge.textContent = displayText;
                        badge.title = `ê²°ì„: ${sortedNumbers.join(', ')}ë²ˆ`;
                        dayStats.appendChild(badge);
                    }
                    
                    // ì§€ê° í•™ìƒ ë²ˆí˜¸ë“¤
                    if (studentsByStatus.late.length > 0) {
                        const badge = document.createElement('span');
                        badge.className = 'stat-badge late';
                        const sortedNumbers = studentsByStatus.late.sort((a, b) => a - b);
                        const displayText = getDisplayText(sortedNumbers);
                        badge.textContent = displayText;
                        badge.title = `ì§€ê°: ${sortedNumbers.join(', ')}ë²ˆ`;
                        dayStats.appendChild(badge);
                    }
                    
                    // ì¡°í‡´ í•™ìƒ ë²ˆí˜¸ë“¤
                    if (studentsByStatus['early-leave'].length > 0) {
                        const badge = document.createElement('span');
                        badge.className = 'stat-badge early';
                        const sortedNumbers = studentsByStatus['early-leave'].sort((a, b) => a - b);
                        const displayText = getDisplayText(sortedNumbers);
                        badge.textContent = displayText;
                        badge.title = `ì¡°í‡´: ${sortedNumbers.join(', ')}ë²ˆ`;
                        dayStats.appendChild(badge);
                    }
                    
                    dayElement.appendChild(dayStats);
                }
                
                calendarGrid.appendChild(dayElement);
            });
        }
        
        // ë‚ ì§œë³„ í†µê³„ ê³„ì‚°
        function getDateStats(dayRecords) {
            const stats = { absent: 0, late: 0, 'early-leave': 0 };
            
            Object.values(dayRecords).forEach(record => {
                if (stats.hasOwnProperty(record.status)) {
                    stats[record.status]++;
                }
            });
            
            return stats;
        }
        
        // ë‚ ì§œë³„ í•™ìƒ ë²ˆí˜¸ ë¶„ë¥˜
        function getStudentsByStatus(dayRecords) {
            const studentsByStatus = { 
                absent: [], 
                late: [], 
                'early-leave': [] 
            };
            
            Object.keys(dayRecords).forEach(studentNumber => {
                const record = dayRecords[studentNumber];
                if (studentsByStatus.hasOwnProperty(record.status)) {
                    studentsByStatus[record.status].push(parseInt(studentNumber));
                }
            });
            
            return studentsByStatus;
        }
        
        // í•™ìƒ ë²ˆí˜¸ í‘œì‹œ í…ìŠ¤íŠ¸ ìƒì„± (ë„ˆë¬´ ê¸¸ë©´ ì¤„ì„)
        function getDisplayText(numbers) {
            const text = numbers.join(',');
            
            // 12ê¸€ì ì´í•˜ë©´ ê·¸ëŒ€ë¡œ í‘œì‹œ
            if (text.length <= 12) {
                return text;
            }
            
            // ë„ˆë¬´ ê¸¸ë©´ ì•ì˜ ëª‡ ê°œë§Œ í‘œì‹œí•˜ê³  +ê°œìˆ˜ ì¶”ê°€
            let displayText = '';
            let charCount = 0;
            let displayCount = 0;
            
            for (let i = 0; i < numbers.length; i++) {
                const numberText = numbers[i].toString();
                const separator = i > 0 ? ',' : '';
                
                if (charCount + separator.length + numberText.length <= 8) {
                    displayText += separator + numberText;
                    charCount += separator.length + numberText.length;
                    displayCount++;
                } else {
                    break;
                }
            }
            
            const remaining = numbers.length - displayCount;
            if (remaining > 0) {
                displayText += `+${remaining}`;
            }
            
            return displayText;
        }
        
        // ë‹¬ ë³€ê²½
        function changeMonth(direction) {
            currentDate.setMonth(currentDate.getMonth() + direction);
            createCalendar();
        }
        
        // ì‘ì—… ë‚ ì§œ ë³€ê²½ (í‰ì¼ë§Œ)
        function changeWorkingDate(direction) {
            let newDate = new Date(workingDate);
            
            do {
                newDate.setDate(newDate.getDate() + direction);
            } while (newDate.getDay() === 0 || newDate.getDay() === 6); // ì£¼ë§ ê±´ë„ˆë›°ê¸°
            
            workingDate = newDate;
            selectedDate = new Date(workingDate); // ì„ íƒëœ ë‚ ì§œë„ í•¨ê»˜ ë³€ê²½
            
            // ì‘ì—… ë‚ ì§œê°€ í˜„ì¬ í‘œì‹œ ì¤‘ì¸ ë‹¬ê³¼ ë‹¤ë¥´ë©´ ë‹¬ë ¥ ì›” ë³€ê²½
            if (workingDate.getMonth() !== currentDate.getMonth() || 
                workingDate.getFullYear() !== currentDate.getFullYear()) {
                currentDate = new Date(workingDate);
            }
            
            displayWorkingDate();
            loadWorkingDateData();
            createCalendar();
        }
        
        // ì‘ì—… ë‚ ì§œë¥¼ ì˜¤ëŠ˜ë¡œ ë³€ê²½
        function goToWorkingToday() {
            const today = new Date();
            // ì˜¤ëŠ˜ì´ ì£¼ë§ì´ë©´ ê°€ì¥ ê°€ê¹Œìš´ í‰ì¼ë¡œ
            if (today.getDay() === 0) { // ì¼ìš”ì¼
                today.setDate(today.getDate() + 1); // ì›”ìš”ì¼ë¡œ
            } else if (today.getDay() === 6) { // í† ìš”ì¼
                today.setDate(today.getDate() + 2); // ì›”ìš”ì¼ë¡œ
            }
            
            workingDate = today;
            selectedDate = new Date(workingDate);
            currentDate = new Date(workingDate);
            
            displayWorkingDate();
            loadWorkingDateData();
            createCalendar();
        }
        
        // ì˜¤ëŠ˜ë¡œ ì´ë™
        function goToToday() {
            currentDate = new Date();
            selectedDate = new Date();
            createCalendar();
        }
        
        // ë‚ ì§œ ì„ íƒ
        function selectDate(date) {
            selectedDate = new Date(date);
            
            // ì‘ì—… ë‚ ì§œë„ í•¨ê»˜ ë³€ê²½ (í‰ì¼ë§Œ)
            if (date.getDay() >= 1 && date.getDay() <= 5) { // í‰ì¼ì¸ ê²½ìš°ë§Œ
                workingDate = new Date(date);
                
                // í™”ë©´ ì—…ë°ì´íŠ¸
                displayWorkingDate();
                loadWorkingDateData();
            }
            
            createCalendar();
        }
        
        // í•™ìƒ ì¹´ë“œë“¤ ìƒì„±
        function createStudentCards() {
            const studentGrid = document.getElementById('studentGrid');
            
            for (let i = 1; i <= 35; i++) {
                const card = document.createElement('div');
                card.className = 'student-card';
                card.id = `student-${i}`;
                
                card.innerHTML = `
                    <div class="student-header">
                        <div class="student-status" id="status-${i}" onclick="clearAttendance(${i})" style="cursor: pointer;" title="í´ë¦­í•˜ì—¬ ì¶œê²° ìƒíƒœ ì´ˆê¸°í™”"></div>
                        <div class="student-number">${i}ë²ˆ</div>
                    </div>
                    <div class="button-group">
                        <button class="status-btn btn-absent" onclick="showAttendanceModal(${i}, 'absent')">ê²°ì„</button>
                        <button class="status-btn btn-late" onclick="showAttendanceModal(${i}, 'late')">ì§€ê°</button>
                        <button class="status-btn btn-early" onclick="showAttendanceModal(${i}, 'early-leave')">ì¡°í‡´</button>
                        <button class="status-btn btn-absent-early" onclick="showAttendanceModal(${i}, 'absent-early')">ê²°ê³¼</button>
                    </div>
                `;
                
                studentGrid.appendChild(card);
            }
        }
        
        // ì‘ì—… ë‚ ì§œ ë°ì´í„° ë¡œë“œ
        function loadWorkingDateData() {
            const workingDateKey = workingDate.toLocaleDateString('ko-KR');
            
            // ë¡œì»¬ ìŠ¤í† ë¦¬ì§€ì—ì„œ í•´ë‹¹ ë‚ ì§œ ë°ì´í„° ë¶ˆëŸ¬ì˜¤ê¸°
            const savedData = localStorage.getItem(`attendance_${workingDateKey}`);
            let workingData = {};
            
            if (savedData) {
                workingData = JSON.parse(savedData);
                // allRecordsì—ë„ ë™ê¸°í™”
                allRecords[workingDateKey] = { ...workingData };
            } else {
                // allRecordsì—ì„œ ì°¾ê¸°
                workingData = allRecords[workingDateKey] || {};
            }
            
            // ëª¨ë“  í•™ìƒì„ ì •ìƒ ìƒíƒœë¡œ ì´ˆê¸°í™”
            for (let i = 1; i <= 35; i++) {
                const card = document.getElementById(`student-${i}`);
                const statusDiv = document.getElementById(`status-${i}`);
                
                if (card && statusDiv) {
                    card.classList.remove('absent', 'late', 'early-leave');
                    statusDiv.textContent = '';
                }
            }
            
            // í•´ë‹¹ ë‚ ì§œì˜ ì¶œê²° ë°ì´í„° ë³µì›
            todayAttendance = { ...workingData };
            
            Object.keys(workingData).forEach(studentNumber => {
                const record = workingData[studentNumber];
                const card = document.getElementById(`student-${studentNumber}`);
                const statusDiv = document.getElementById(`status-${studentNumber}`);
                
                if (card && statusDiv) {
                    card.classList.add(record.status);
                    
                    // v2 ìƒˆ ê¸°ëŠ¥: ì¸ì • ìœ í˜•ì— ë”°ë¥¸ ìƒíƒœ í…ìŠ¤íŠ¸ ì„¤ì •
                    const verificationType = record.verificationType || 'verified';
                    let displayText;
                    
                    // ê°„ê²°í•œ ìœ í˜• í‘œì‹œ
                    if (verificationType === 'medical') {
                        displayText = 'ì§ˆë³‘';
                    } else if (verificationType === 'unverified') {
                        displayText = 'ë¯¸ì¸ì •';
                    } else {
                        displayText = 'ì¸ì •';
                    }
                    
                    // êµì‹œ ë²”ìœ„ í‘œì‹œ ì²˜ë¦¬ (ê²°ì„ì€ êµì‹œ ì •ë³´ ì—†ìŒ)
                    if (record.status !== 'absent' && (record.period || (record.startPeriod !== undefined && record.endPeriod !== undefined))) {
                        let periodText = '';
                        
                        if (record.startPeriod !== undefined && record.endPeriod !== undefined && record.startPeriod !== null && record.endPeriod !== null) {
                            // ìƒˆë¡œìš´ ë²”ìœ„ ë°©ì‹
                            const startName = record.startPeriod === 0 ? 'ì¡°ë¡€' : record.startPeriod;
                            const endName = record.endPeriod === 0 ? 'ì¡°ë¡€' : record.endPeriod;
                            
                            if (record.startPeriod === record.endPeriod) {
                                periodText = ` (${startName === 'ì¡°ë¡€' ? 'ì¡°ë¡€' : startName + 'êµì‹œ'})`;
                            } else {
                                if (startName !== 'ì¡°ë¡€' && endName !== 'ì¡°ë¡€') {
                                    periodText = ` (${startName}~${endName}êµì‹œ)`;
                                } else {
                                    periodText = ` (${startName === 'ì¡°ë¡€' ? 'ì¡°ë¡€' : startName + 'êµì‹œ'}~${endName === 'ì¡°ë¡€' ? 'ì¡°ë¡€' : endName + 'êµì‹œ'})`;
                                }
                            }
                        } else if (typeof record.period === 'object' && record.period.start !== undefined && record.period.end !== undefined) {
                            // ë²”ìœ„ ê°ì²´
                            const startName = record.period.start === 0 ? 'ì¡°ë¡€' : record.period.start;
                            const endName = record.period.end === 0 ? 'ì¡°ë¡€' : record.period.end;
                            
                            if (record.period.start === record.period.end) {
                                periodText = ` (${startName === 'ì¡°ë¡€' ? 'ì¡°ë¡€' : startName + 'êµì‹œ'})`;
                            } else {
                                if (startName !== 'ì¡°ë¡€' && endName !== 'ì¡°ë¡€') {
                                    periodText = ` (${startName}~${endName}êµì‹œ)`;
                                } else {
                                    periodText = ` (${startName === 'ì¡°ë¡€' ? 'ì¡°ë¡€' : startName + 'êµì‹œ'}~${endName === 'ì¡°ë¡€' ? 'ì¡°ë¡€' : endName + 'êµì‹œ'})`;
                                }
                            }
                        } else if (record.period && (record.status === 'late' || record.status === 'early-leave' || record.status === 'absent-early')) {
                            // ê¸°ì¡´ ë‹¨ì¼ êµì‹œ ë°©ì‹
                            periodText = ` (${record.period}êµì‹œ)`;
                        }
                        
                        displayText += periodText;
                    }
                    
                    statusDiv.textContent = displayText;
                }
            });
            
            updateTodayStats();
        }
        
        // ë²”ìœ„ ì„ íƒì„ ìœ„í•œ ë³€ìˆ˜ë“¤
        let selectedStartPeriod = null;
        let selectedEndPeriod = null;
        
        // êµì‹œ ì„ íƒ ëª¨ë‹¬ í‘œì‹œ
        function showPeriodModal(studentNumber, status) {
            pendingStudent = studentNumber;
            pendingStatus = status;
            selectedStartPeriod = null;
            selectedEndPeriod = null;
            
            const modal = document.getElementById('periodModal');
            const title = document.getElementById('periodModalTitle');
            const subtitle = document.getElementById('periodModalSubtitle');
            
            const statusText = {
                'late': 'ì§€ê°', 
                'early-leave': 'ì¡°í‡´', 
                'absent-early': 'ê²°ê³¼',
                'absent': 'ê²°ì„'
            }[status] || status;
            
            title.textContent = `${studentNumber}ë²ˆ í•™ìƒ ${statusText} - ì‹œì‘ êµì‹œë¥¼ ì„ íƒí•˜ì„¸ìš”`;
            subtitle.textContent = "ì²« ë²ˆì§¸ í´ë¦­: ì‹œì‘ êµì‹œ, ë‘ ë²ˆì§¸ í´ë¦­: ë êµì‹œ";
            
            // ëª¨ë“  ë²„íŠ¼ ì´ˆê¸°í™”
            resetPeriodButtons();
            modal.style.display = 'block';
        }
        
        // êµì‹œ ë²”ìœ„ ì„ íƒ
        function selectPeriodRange(period) {
            if (selectedStartPeriod === null) {
                // ì²« ë²ˆì§¸ í´ë¦­: ì‹œì‘ êµì‹œ ì„¤ì •
                selectedStartPeriod = period;
                updatePeriodButtons();
                document.getElementById('periodModalTitle').textContent = 
                    `${pendingStudent}ë²ˆ í•™ìƒ - ë êµì‹œë¥¼ ì„ íƒí•˜ì„¸ìš”`;
                document.getElementById('periodModalSubtitle').textContent = 
                    `ì‹œì‘: ${getPeriodName(period)} | ë êµì‹œë¥¼ í´ë¦­í•˜ì„¸ìš”`;
            } else if (selectedEndPeriod === null) {
                // ë‘ ë²ˆì§¸ í´ë¦­: ë êµì‹œ ì„¤ì •
                if (period >= selectedStartPeriod) {
                    selectedEndPeriod = period;
                    updatePeriodButtons();
                    
                    // ì„ íƒ ì™„ë£Œ - ì¶œê²° ì²˜ë¦¬
                    const verificationType = pendingVerificationType || 'verified';
                    setAttendanceWithVerification(pendingStudent, pendingStatus, 
                        {start: selectedStartPeriod, end: selectedEndPeriod}, verificationType);
                    closePeriodModal();
                } else {
                    alert('ë êµì‹œëŠ” ì‹œì‘ êµì‹œë³´ë‹¤ ê°™ê±°ë‚˜ ëŠ¦ì–´ì•¼ í•©ë‹ˆë‹¤.');
                }
            }
        }
        
        // êµì‹œ ë²ˆí˜¸ë¥¼ ì´ë¦„ìœ¼ë¡œ ë³€í™˜
        function getPeriodName(period) {
            return period === 0 ? 'ì¡°ë¡€' : `${period}êµì‹œ`;
        }
        
        // êµì‹œ ë²„íŠ¼ ìƒíƒœ ì—…ë°ì´íŠ¸
        function updatePeriodButtons() {
            resetPeriodButtons();
            
            if (selectedStartPeriod !== null) {
                const startBtn = document.getElementById(`period-${selectedStartPeriod}`);
                startBtn.classList.add('start-selected');
                
                if (selectedEndPeriod !== null) {
                    const endBtn = document.getElementById(`period-${selectedEndPeriod}`);
                    endBtn.classList.add('end-selected');
                    
                    // ë²”ìœ„ ë‚´ ë²„íŠ¼ë“¤ í‘œì‹œ
                    for (let i = selectedStartPeriod + 1; i < selectedEndPeriod; i++) {
                        const btn = document.getElementById(`period-${i}`);
                        if (btn) btn.classList.add('in-range');
                    }
                }
            }
        }
        
        // êµì‹œ ë²„íŠ¼ ì´ˆê¸°í™”
        function resetPeriodButtons() {
            for (let i = 0; i <= 7; i++) {
                const btn = document.getElementById(`period-${i}`);
                if (btn) {
                    btn.classList.remove('start-selected', 'end-selected', 'in-range');
                }
            }
        }
        
        // êµì‹œ ì„ íƒ ì´ˆê¸°í™”
        function resetPeriodSelection() {
            selectedStartPeriod = null;
            selectedEndPeriod = null;
            resetPeriodButtons();
            
            const statusText = {
                'late': 'ì§€ê°', 
                'early-leave': 'ì¡°í‡´', 
                'absent-early': 'ê²°ê³¼',
                'absent': 'ê²°ì„'
            }[pendingStatus] || pendingStatus;
            
            document.getElementById('periodModalTitle').textContent = 
                `${pendingStudent}ë²ˆ í•™ìƒ ${statusText} - ì‹œì‘ êµì‹œë¥¼ ì„ íƒí•˜ì„¸ìš”`;
            document.getElementById('periodModalSubtitle').textContent = 
                "ì²« ë²ˆì§¸ í´ë¦­: ì‹œì‘ êµì‹œ, ë‘ ë²ˆì§¸ í´ë¦­: ë êµì‹œ";
        }
        
        // êµì‹œ ëª¨ë‹¬ ë‹«ê¸°
        function closePeriodModal() {
            document.getElementById('periodModal').style.display = 'none';
            selectedStartPeriod = null;
            selectedEndPeriod = null;
            resetPeriodButtons();
            pendingStudent = null;
            pendingStatus = null;
            pendingVerificationType = null;
        }

        // v2 ìƒˆ ê¸°ëŠ¥: ì¶œì„ ìƒíƒœ ëª¨ë‹¬ í‘œì‹œ
        function showAttendanceModal(studentNumber, status) {
            pendingStudent = studentNumber;
            pendingStatus = status;
            
            const modal = document.getElementById('attendanceModal');
            const title = document.getElementById('attendanceModalTitle');
            
            const statusText = status === 'late' ? 'ì§€ê°' : status === 'early-leave' ? 'ì¡°í‡´' : 'ê²°ì„';
            title.textContent = `${studentNumber}ë²ˆ í•™ìƒ ${statusText} - ìœ í˜•ì„ ì„ íƒí•˜ì„¸ìš”`;
            
            modal.style.display = 'block';
        }

        // v2 ìƒˆ ê¸°ëŠ¥: ì¶œì„ ìœ í˜• ì„ íƒ
        function selectAttendanceType(verificationType) {
            if (pendingStudent && pendingStatus) {
                pendingVerificationType = verificationType;
                
                // ì§€ê°ê³¼ ì¡°í‡´ì¸ ê²½ìš° êµì‹œ ì„ íƒ ëª¨ë‹¬ë¡œ ì´ë™
                if (pendingStatus === 'late' || pendingStatus === 'early-leave') {
                    closeAttendanceModal();
                    showPeriodModal(pendingStudent, pendingStatus);
                } else {
                    // ê²°ì„ì¸ ê²½ìš° ë°”ë¡œ ì²˜ë¦¬
                    setAttendanceWithVerification(pendingStudent, pendingStatus, null, verificationType);
                    closeAttendanceModal();
                }
            }
        }

        // v2 ìƒˆ ê¸°ëŠ¥: ì¶œì„ ëª¨ë‹¬ ë‹«ê¸°
        function closeAttendanceModal() {
            document.getElementById('attendanceModal').style.display = 'none';
            // êµì‹œ ì„ íƒìœ¼ë¡œ ë„˜ì–´ê°€ëŠ” ê²½ìš° pendingVerificationTypeì€ ìœ ì§€
            if (pendingStatus !== 'late' && pendingStatus !== 'early-leave') {
                pendingStudent = null;
                pendingStatus = null;
                pendingVerificationType = null;
            }
        }
        
        // v2 ìƒˆ ê¸°ëŠ¥: ì¸ì • ìœ í˜•ì´ í¬í•¨ëœ ì¶œê²° ìƒíƒœ ì„¤ì •
        function setAttendanceWithVerification(studentNumber, status, periodRange = null, verificationType = 'verified') {
            const card = document.getElementById(`student-${studentNumber}`);
            const statusDiv = document.getElementById(`status-${studentNumber}`);
            const currentTime = new Date();
            const workingDateKey = workingDate.toLocaleDateString('ko-KR');
            
            // ì´ì „ ìƒíƒœ ì œê±°
            card.classList.remove('absent', 'late', 'early-leave', 'absent-early');
            
            // ìƒˆ ìƒíƒœ ì„¤ì •
            card.classList.add(status);
            
            const statusText = {
                'absent': 'ê²°ì„',
                'late': 'ì§€ê°',
                'early-leave': 'ì¡°í‡´',
                'absent-early': 'ê²°ê³¼'
            };
            
            const timeString = currentTime.toLocaleTimeString('ko-KR', {
                hour: '2-digit',
                minute: '2-digit'
            });
            
            // êµì‹œ ë²”ìœ„ ì²˜ë¦¬
            let periodText = '';
            let startPeriod = null;
            let endPeriod = null;
            
            // ê²°ì„ì€ êµì‹œ ì •ë³´ ì—†ì´ ì²˜ë¦¬
            if (status === 'absent' && periodRange === null) {
                // ê²°ì„ì€ êµì‹œ ë²”ìœ„ ì—†ìŒ
                periodText = '';
                startPeriod = null;
                endPeriod = null;
            } else if (periodRange) {
                if (typeof periodRange === 'object' && periodRange.start !== undefined && periodRange.end !== undefined) {
                    // ìƒˆë¡œìš´ ë²”ìœ„ ë°©ì‹
                    startPeriod = periodRange.start;
                    endPeriod = periodRange.end;
                    
                    const startName = startPeriod === 0 ? 'ì¡°ë¡€' : startPeriod;
                    const endName = endPeriod === 0 ? 'ì¡°ë¡€' : endPeriod;
                    
                    if (startPeriod === endPeriod) {
                        periodText = ` (${startName === 'ì¡°ë¡€' ? 'ì¡°ë¡€' : startName + 'êµì‹œ'})`;
                    } else {
                        // ë‘˜ ë‹¤ ì¡°ë¡€ê°€ ì•„ë‹Œ ê²½ìš°: "3~4êµì‹œ"
                        if (startName !== 'ì¡°ë¡€' && endName !== 'ì¡°ë¡€') {
                            periodText = ` (${startName}~${endName}êµì‹œ)`;
                        } else {
                            // ì¡°ë¡€ê°€ í¬í•¨ëœ ê²½ìš°: "ì¡°ë¡€~3êµì‹œ" 
                            periodText = ` (${startName === 'ì¡°ë¡€' ? 'ì¡°ë¡€' : startName + 'êµì‹œ'}~${endName === 'ì¡°ë¡€' ? 'ì¡°ë¡€' : endName + 'êµì‹œ'})`;
                        }
                    }
                } else {
                    // ê¸°ì¡´ ë°©ì‹ (ë‹¨ì¼ êµì‹œ)
                    startPeriod = 1;
                    endPeriod = periodRange;
                    periodText = ` (${periodRange}êµì‹œ)`;
                }
            }
            
            // v2 ìƒˆ ê¸°ëŠ¥: ì¸ì • ìœ í˜•ì— ë”°ë¥¸ í…ìŠ¤íŠ¸ ìƒì„±
            let displayText;
            
            // ê°„ê²°í•œ ìœ í˜• í‘œì‹œ
            if (verificationType === 'medical') {
                displayText = 'ì§ˆë³‘';
            } else if (verificationType === 'unverified') {
                displayText = 'ë¯¸ì¸ì •';
            } else {
                displayText = 'ì¸ì •';
            }
            
            displayText += periodText;
            statusDiv.textContent = displayText;
            
            // ì‘ì—… ë‚ ì§œ ì¶œê²° ê¸°ë¡ì— ì¶”ê°€
            const periodData = periodRange && typeof periodRange === 'object' ? periodRange : periodRange;
            
            if (!todayAttendance[studentNumber] || todayAttendance[studentNumber].status !== status || 
                JSON.stringify(todayAttendance[studentNumber].period) !== JSON.stringify(periodData)) {
                todayAttendance[studentNumber] = {
                    status: status,
                    time: timeString,
                    timestamp: currentTime.toISOString(),
                    date: workingDateKey,
                    period: periodData, // êµì‹œ ë²”ìœ„ ì •ë³´
                    startPeriod: startPeriod, // ì‹œì‘ êµì‹œ
                    endPeriod: endPeriod, // ë êµì‹œ
                    verificationType: verificationType // v2 ìƒˆ ê¸°ëŠ¥: ì„ íƒëœ ì¸ì • ìœ í˜•
                };
            }
            
            // ë¨¼ì € allRecords ì—…ë°ì´íŠ¸
            allRecords[workingDateKey] = { ...todayAttendance };
            
            updateTodayStats();
            saveWorkingDateData();
            
            
            // ë‹¬ë ¥ ìƒˆë¡œê³ ì¹¨ (ì‘ì—… ë‚ ì§œì— ë°°ì§€ í‘œì‹œ) - ì•½ê°„ì˜ ì§€ì—°ìœ¼ë¡œ í™•ì‹¤í•œ ì—…ë°ì´íŠ¸
            setTimeout(() => {
                createCalendar();
            }, 10);
            
            const messagePeriodText = periodText || '';
            showMessage(`${studentNumber}ë²ˆ í•™ìƒì´ ${statusText[status]}${messagePeriodText}ìœ¼ë¡œ ì²˜ë¦¬ë˜ì—ˆìŠµë‹ˆë‹¤.`);
        }
        
        // ì¶œê²° ìƒíƒœ ì„¤ì • (ê²°ì„ìš© - êµì‹œ ì—†ìŒ)
        function setAttendance(studentNumber, status) {
            // ê²°ì„ì€ êµì‹œ ì •ë³´ ì—†ì´ ë°”ë¡œ ì²˜ë¦¬
            setAttendanceWithPeriod(studentNumber, status, null);
        }
        
        // ì¶œê²° ìƒíƒœ ì·¨ì†Œ
        function clearAttendance(studentNumber) {
            const card = document.getElementById(`student-${studentNumber}`);
            const statusDiv = document.getElementById(`status-${studentNumber}`);
            
            // ìƒíƒœ ì œê±°
            card.classList.remove('absent', 'late', 'early-leave');
            statusDiv.textContent = '';
            
            // ê¸°ë¡ì—ì„œ ì œê±°
            delete todayAttendance[studentNumber];
            
            // ë¨¼ì € allRecords ì—…ë°ì´íŠ¸
            const workingDateKey = workingDate.toLocaleDateString('ko-KR');
            allRecords[workingDateKey] = { ...todayAttendance };
            
            updateTodayStats();
            saveWorkingDateData();
            
            
            // ë‹¬ë ¥ ìƒˆë¡œê³ ì¹¨ - ì•½ê°„ì˜ ì§€ì—°ìœ¼ë¡œ í™•ì‹¤í•œ ì—…ë°ì´íŠ¸
            setTimeout(() => {
                createCalendar();
            }, 10);
            
            showMessage(`${studentNumber}ë²ˆ í•™ìƒì˜ ì¶œê²°ì´ ì·¨ì†Œë˜ì—ˆìŠµë‹ˆë‹¤.`);
        }
        
        // ì˜¤ëŠ˜ í†µê³„ ì—…ë°ì´íŠ¸ (í†µê³„ ì„¹ì…˜ì´ ì—†ìœ¼ë¯€ë¡œ ë¹ˆ í•¨ìˆ˜)
        function updateTodayStats() {
            // í†µê³„ í‘œì‹œ ì„¹ì…˜ì´ ì œê±°ë˜ì—ˆìœ¼ë¯€ë¡œ ì‹¤ì œ ë™ì‘ì€ í•˜ì§€ ì•ŠìŒ
            // í•¨ìˆ˜ í˜¸ì¶œ ì˜¤ë¥˜ë¥¼ ë°©ì§€í•˜ê¸° ìœ„í•´ ë¹ˆ í•¨ìˆ˜ë¡œ ìœ ì§€
        }
        
        
        

        // ìƒíƒœ í•œê¸€ ë³€í™˜
        function getStatusKorean(status) {
            const statusMap = {
                'absent': 'ê²°ì„',
                'late': 'ì§€ê°',
                'early-leave': 'ì¡°í‡´',
                'absent-early': 'ê²°ê³¼'
            };
            return statusMap[status] || status;
        }
        
        
        // ë©”ì‹œì§€ í‘œì‹œ (ê°„ë‹¨í•œ ì½˜ì†” ë¡œê·¸)
        function showMessage(message) {
            console.log(message);
        }
        
        // ì˜¤ëŠ˜ ì´ˆê¸°í™”
        function resetToday() {
            if (confirm('ì˜¤ëŠ˜ì˜ ì¶œê²°ì„ ëª¨ë‘ ì´ˆê¸°í™”í•˜ì‹œê² ìŠµë‹ˆê¹Œ?')) {
                todayAttendance = {};
                
                // ëª¨ë“  í•™ìƒì„ ì¶œì„ìœ¼ë¡œ ì´ˆê¸°í™”
                for (let i = 1; i <= 35; i++) {
                    const card = document.getElementById(`student-${i}`);
                    const statusDiv = document.getElementById(`status-${i}`);
                    
                    card.classList.remove('absent', 'late', 'early-leave');
                    card.classList.add('present');
                    statusDiv.textContent = 'ì¶œì„';
                }
                
                updateTodayStats();
                saveToLocalStorage();
                
                showMessage('ì˜¤ëŠ˜ ì¶œê²°ì´ ì´ˆê¸°í™”ë˜ì—ˆìŠµë‹ˆë‹¤.');
            }
        }
        
        // ì˜¤ëŠ˜ ê¸°ë¡ CSV ë‚´ë³´ë‚´ê¸°
        function exportTodayToCSV() {
            const records = Object.keys(todayAttendance).map(studentNumber => {
                const record = todayAttendance[studentNumber];
                return `${record.date},${studentNumber},${getStatusKorean(record.status)},${record.time}`;
            });
            
            if (records.length === 0) {
                alert('ë‚´ë³´ë‚¼ ê¸°ë¡ì´ ì—†ìŠµë‹ˆë‹¤.');
                return;
            }
            
            const workingDateString = workingDate.toLocaleDateString('ko-KR', {
                month: 'long',
                day: 'numeric',
                weekday: 'long'
            });
            
            if (confirm(`${workingDateString}ì˜ ì¶œê²° ê¸°ë¡ì„ CSV íŒŒì¼ë¡œ ë‹¤ìš´ë¡œë“œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?\n\nì´ ${records.length}ê±´ì˜ ê¸°ë¡ì´ ìˆìŠµë‹ˆë‹¤.`)) {
                const today = new Date().toLocaleDateString('ko-KR');
                const csvContent = 'data:text/csv;charset=utf-8,' 
                    + 'ë‚ ì§œ,í•™ìƒë²ˆí˜¸,ìƒíƒœ,ì‹œê°„\n'
                    + records.join('\n');
                
                downloadCSV(csvContent, `ì¶œê²°ê¸°ë¡_${today}.csv`);
            }
        }
        
        // ì „ì²´ ê¸°ë¡ CSV ë‚´ë³´ë‚´ê¸°
        function exportAllToCSV() {
            let allCsvRecords = [];
            
            Object.keys(allRecords).forEach(date => {
                Object.keys(allRecords[date]).forEach(studentNumber => {
                    const record = allRecords[date][studentNumber];
                    allCsvRecords.push(`${date},${studentNumber},${getStatusKorean(record.status)},${record.time}`);
                });
            });
            
            if (allCsvRecords.length === 0) {
                alert('ë‚´ë³´ë‚¼ ëˆ„ì  ê¸°ë¡ì´ ì—†ìŠµë‹ˆë‹¤.');
                return;
            }
            
            const totalDays = Object.keys(allRecords).length;
            
            if (confirm(`ì „ì²´ ì¶œê²° ê¸°ë¡ì„ CSV íŒŒì¼ë¡œ ë‹¤ìš´ë¡œë“œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?\n\nì´ ${totalDays}ì¼ê°„ ${allCsvRecords.length}ê±´ì˜ ê¸°ë¡ì´ ìˆìŠµë‹ˆë‹¤.`)) {
                const csvContent = 'data:text/csv;charset=utf-8,' 
                    + 'ë‚ ì§œ,í•™ìƒë²ˆí˜¸,ìƒíƒœ,ì‹œê°„\n'
                    + allCsvRecords.join('\n');
                
                const today = new Date().toLocaleDateString('ko-KR');
                downloadCSV(csvContent, `ì „ì²´ì¶œê²°ê¸°ë¡_${today}.csv`);
            }
        }
        
        // CSV ë‹¤ìš´ë¡œë“œ í—¬í¼ í•¨ìˆ˜
        function downloadCSV(csvContent, filename) {
            const encodedUri = encodeURI(csvContent);
            const link = document.createElement('a');
            link.setAttribute('href', encodedUri);
            link.setAttribute('download', filename);
            document.body.appendChild(link);
            link.click();
            document.body.removeChild(link);
        }
        
        // ëˆ„ì  ê¸°ë¡ ë³´ê¸°
        function showHistory() {
            const modal = document.getElementById('historyModal');
            
            // ì „ì²´ ê¸°ë¡ í‘œì‹œ
            filterByMonth('');
            modal.style.display = 'block';
        }

        // ì›” ì„ íƒ ëª¨ë‹¬ í‘œì‹œ
        function showMonthSelector() {
            console.log('Opening month selector'); // ë””ë²„ê·¸ìš©
            updateMonthButtons();
            document.getElementById('monthSelectorModal').style.display = 'block';
        }

        // ì›” ì„ íƒ ëª¨ë‹¬ ë‹«ê¸°
        function closeMonthSelector() {
            document.getElementById('monthSelectorModal').style.display = 'none';
        }

        // ì›” ë²„íŠ¼ ìƒíƒœ ì—…ë°ì´íŠ¸
        function updateMonthButtons() {
            const availableMonths = new Set();
            const currentYear = new Date().getFullYear().toString();
            
            // ê¸°ì¡´ ê¸°ë¡ì—ì„œ ì›” ì¶”ì¶œ (ì˜¬í•´ë§Œ)
            Object.keys(allRecords).forEach(dateKey => {
                const dateParts = dateKey.split('.');
                const year = dateParts[0];
                const month = dateParts[1].trim().padStart(2, '0'); // trim() ì¶”ê°€í•˜ì—¬ ê³µë°± ì œê±°
                
                if (year === currentYear) {
                    availableMonths.add(month);
                }
            });
            
            console.log('Available months:', Array.from(availableMonths)); // ë””ë²„ê·¸ìš©
            
            // ëª¨ë“  ì›” ë²„íŠ¼ ìƒíƒœ ì„¤ì •
            for (let i = 1; i <= 12; i++) {
                const monthStr = i.toString().padStart(2, '0');
                const btn = document.getElementById(`month-${i}`);
                
                if (availableMonths.has(monthStr)) {
                    btn.disabled = false;
                    btn.style.opacity = '1';
                    console.log(`Month ${i} enabled`); // ë””ë²„ê·¸ìš©
                } else {
                    btn.disabled = true;
                    btn.style.opacity = '0.5';
                    console.log(`Month ${i} disabled`); // ë””ë²„ê·¸ìš©
                }
            }
        }

        // ì›” ì„ íƒ
        function selectMonth(month) {
            console.log('Month selected:', month); // ë””ë²„ê·¸ìš©
            closeMonthSelector();
            filterByMonth(month);
        }

        // ì›”ë³„ í•„í„°ë§
        function filterByMonth(month) {
            // í˜„ì¬ ì„ íƒëœ ì›” ì—…ë°ì´íŠ¸
            currentSelectedMonth = month;
            
            // ë²„íŠ¼ ìƒíƒœ ì—…ë°ì´íŠ¸
            const allBtn = document.getElementById('btn-all');
            
            if (month === '') {
                allBtn.style.backgroundColor = '#007bff';
                allBtn.style.color = 'white';
            } else {
                allBtn.style.backgroundColor = '';
                allBtn.style.color = '';
            }
            
            displayFilteredHistory(month);
        }

        // í•„í„°ë§ëœ ê¸°ë¡ í‘œì‹œ
        function displayFilteredHistory(selectedMonth = '') {
            const content = document.getElementById('historyContent');
            
            if (Object.keys(allRecords).length === 0) {
                content.innerHTML = '<p style="text-align: center; color: #666;">ì•„ì§ ëˆ„ì  ê¸°ë¡ì´ ì—†ìŠµë‹ˆë‹¤.</p>';
                return;
            }

            let filteredRecords = { ...allRecords };

            // ì›”ë³„ í•„í„°ë§
            if (selectedMonth) {
                filteredRecords = {};
                const currentYear = new Date().getFullYear().toString();
                
                Object.keys(allRecords).forEach(dateKey => {
                    const dateParts = dateKey.split('.');
                    const year = dateParts[0];
                    const month = dateParts[1].trim().padStart(2, '0'); // trim() ì¶”ê°€
                    
                    if (year === currentYear && month === selectedMonth) {
                        filteredRecords[dateKey] = allRecords[dateKey];
                    }
                });
            }

            if (Object.keys(filteredRecords).length === 0) {
                const selectedText = selectedMonth ? 
                    `${parseInt(selectedMonth)}ì›”` : 
                    'ì„ íƒí•œ ê¸°ê°„';
                content.innerHTML = `<p style="text-align: center; color: #666;">${selectedText}ì— ê¸°ë¡ì´ ì—†ìŠµë‹ˆë‹¤.</p>`;
                return;
            }

            let historyHTML = '';
            
            // ì„ íƒëœ ì›”ì˜ ì´ ê¸°ë¡ ìˆ˜ ê³„ì‚°
            const totalRecords = Object.keys(filteredRecords).reduce((total, date) => {
                return total + Object.keys(filteredRecords[date]).length;
            }, 0);

            // ì›”ë³„ ìš”ì•½ ì •ë³´ ì¶”ê°€
            if (selectedMonth) {
                const currentYear = new Date().getFullYear();
                historyHTML += `
                    <div style="margin-bottom: 20px; padding: 15px; background-color: #e3f2fd; border-radius: 8px; text-align: center;">
                        <h3 style="margin: 0; color: #1976d2;">${currentYear}ë…„ ${parseInt(selectedMonth)}ì›” ì¶œê²° í˜„í™©</h3>
                        <p style="margin: 5px 0 0 0; color: #666;">ì´ ${Object.keys(filteredRecords).length}ì¼ê°„ ${totalRecords}ê±´ì˜ ê¸°ë¡</p>
                    </div>
                `;
            }
            
            Object.keys(filteredRecords).sort().reverse().forEach(date => {
                const dayRecords = filteredRecords[date];
                const recordCount = Object.keys(dayRecords).length;
                
                historyHTML += `
                    <div style="margin-bottom: 20px; padding: 15px; background-color: #f8f9fa; border-radius: 8px;">
                        <h4 style="cursor: pointer; color: #007bff; text-decoration: underline;" onclick="goToDate('${date}')" title="í´ë¦­í•˜ì—¬ ${date}ë¡œ ì´ë™">${date} (${recordCount}ê±´)</h4>
                        <div style="display: grid; gap: 8px;">
                `;
                
                Object.keys(dayRecords).forEach(studentNumber => {
                    const record = dayRecords[studentNumber];
                    let statusText = getStatusKorean(record.status);
                    
                    // v2: ê°„ê²°í•œ ìœ í˜• í‘œì‹œ
                    const verificationType = record.verificationType || 'verified';
                    if (verificationType === 'medical') {
                        statusText = 'ì§ˆë³‘';
                    } else if (verificationType === 'unverified') {
                        statusText = 'ë¯¸ì¸ì •';
                    } else {
                        statusText = 'ì¸ì •';
                    }
                    
                    if (record.period && (record.status === 'late' || record.status === 'early-leave')) {
                        statusText += ` (${record.period}êµì‹œ)`;
                    }
                    
                    historyHTML += `
                        <div style="display: flex; justify-content: space-between; padding: 8px; background-color: white; border-radius: 4px;">
                            <span><strong>${studentNumber}ë²ˆ</strong> - ${statusText}</span>
                            <span>${record.time}</span>
                        </div>
                    `;
                });
                
                historyHTML += '</div></div>';
            });
            
            content.innerHTML = historyHTML;
        }
        
        // ëˆ„ì  ê¸°ë¡ ëª¨ë‹¬ ë‹«ê¸°
        function closeHistory() {
            document.getElementById('historyModal').style.display = 'none';
        }
        
        // í˜„ì¬ ì„ íƒëœ ì›”
        let currentSelectedMonth = '';

        // ëˆ„ì  ê¸°ë¡ í”„ë¦°íŠ¸
        function printHistory() {
            // í˜„ì¬ í™”ë©´ì— í‘œì‹œëœ ë‚´ìš©ì„ ê¸°ë°˜ìœ¼ë¡œ í”„ë¦°íŠ¸
            const content = document.getElementById('historyContent').innerHTML;
            
            if (content.includes('ê¸°ë¡ì´ ì—†ìŠµë‹ˆë‹¤')) {
                alert('í”„ë¦°íŠ¸í•  ê¸°ë¡ì´ ì—†ìŠµë‹ˆë‹¤.');
                return;
            }
            
            // í˜„ì¬ í•„í„° ìƒíƒœ í™•ì¸
            let filterTitle = '';
            let recordCount = 0;
            let dayCount = 0;
            
            if (currentSelectedMonth === '') {
                // ì „ì²´ ê¸°ë¡
                filterTitle = 'ì „ì²´ ëˆ„ì  ì¶œê²° ê¸°ë¡';
                dayCount = Object.keys(allRecords).length;
                recordCount = Object.keys(allRecords).reduce((total, date) => {
                    return total + Object.keys(allRecords[date]).length;
                }, 0);
            } else {
                // íŠ¹ì • ì›” ê¸°ë¡
                const currentYear = new Date().getFullYear();
                const monthNum = parseInt(currentSelectedMonth);
                filterTitle = `${currentYear}ë…„ ${monthNum}ì›” ì¶œê²° ê¸°ë¡`;
                
                // í˜„ì¬ í•„í„°ë§ëœ ê¸°ë¡ ê³„ì‚°
                let filteredRecords = {};
                const currentYearStr = currentYear.toString();
                
                Object.keys(allRecords).forEach(dateKey => {
                    const dateParts = dateKey.split('.');
                    const year = dateParts[0];
                    const month = dateParts[1].trim().padStart(2, '0');
                    
                    if (year === currentYearStr && month === currentSelectedMonth) {
                        filteredRecords[dateKey] = allRecords[dateKey];
                    }
                });
                
                dayCount = Object.keys(filteredRecords).length;
                recordCount = Object.keys(filteredRecords).reduce((total, date) => {
                    return total + Object.keys(filteredRecords[date]).length;
                }, 0);
            }
            
            if (confirm(`${filterTitle}ì„ í”„ë¦°íŠ¸í•˜ì‹œê² ìŠµë‹ˆê¹Œ?\n\nì´ ${dayCount}ì¼ê°„ ${recordCount}ê±´ì˜ ê¸°ë¡ì´ ìˆìŠµë‹ˆë‹¤.`)) {
                // í”„ë¦°íŠ¸ë¥¼ ìœ„í•´ ì œëª© ì„ì‹œ ë³€ê²½
                const originalTitle = document.querySelector('#historyModal .modal-header h2').textContent;
                document.querySelector('#historyModal .modal-header h2').textContent = filterTitle;
                
                window.print();
                
                // ì›ë˜ ì œëª©ìœ¼ë¡œ ë³µì›
                document.querySelector('#historyModal .modal-header h2').textContent = originalTitle;
            }
        }
        
        // íŠ¹ì • ë‚ ì§œë¡œ ì´ë™ (ëˆ„ì  ê¸°ë¡ì—ì„œ í˜¸ì¶œ)
        function goToDate(dateString) {
            // í•œêµ­ ë‚ ì§œ ë¬¸ìì—´ì„ Date ê°ì²´ë¡œ ë³€í™˜
            const dateParts = dateString.split('.');
            const year = parseInt(dateParts[0]);
            const month = parseInt(dateParts[1]) - 1; // JavaScript ì›”ì€ 0ë¶€í„° ì‹œì‘
            const day = parseInt(dateParts[2]);
            
            const targetDate = new Date(year, month, day);
            
            // ì£¼ë§ì¸ì§€ í™•ì¸í•˜ê³  í‰ì¼ë¡œ ì¡°ì •
            if (targetDate.getDay() === 0) { // ì¼ìš”ì¼
                targetDate.setDate(targetDate.getDate() + 1); // ì›”ìš”ì¼ë¡œ
            } else if (targetDate.getDay() === 6) { // í† ìš”ì¼
                targetDate.setDate(targetDate.getDate() + 2); // ì›”ìš”ì¼ë¡œ
            }
            
            // ì‘ì—… ë‚ ì§œì™€ ì„ íƒëœ ë‚ ì§œ ë³€ê²½
            workingDate = new Date(targetDate);
            selectedDate = new Date(targetDate);
            currentDate = new Date(targetDate);
            
            // ëª¨ë‹¬ ë‹«ê¸°
            closeHistory();
            
            // í™”ë©´ ì—…ë°ì´íŠ¸
            displayWorkingDate();
            loadWorkingDateData();
            createCalendar();
        }
        
        // ì‘ì—… ë‚ ì§œ ë°ì´í„° ì €ì¥
        function saveWorkingDateData() {
            const workingDateKey = workingDate.toLocaleDateString('ko-KR');
            
            // ì‘ì—… ë‚ ì§œ ê¸°ë¡ ì €ì¥
            localStorage.setItem(`attendance_${workingDateKey}`, JSON.stringify(todayAttendance));
            
            // ëˆ„ì  ê¸°ë¡ì— ì¶”ê°€
            allRecords[workingDateKey] = { ...todayAttendance };
            localStorage.setItem('attendance_all', JSON.stringify(allRecords));
        }
        
        // ë¡œì»¬ ìŠ¤í† ë¦¬ì§€ì— ì €ì¥ (í•˜ìœ„ í˜¸í™˜ìš©)
        function saveToLocalStorage() {
            saveWorkingDateData();
        }
        
        // ë¡œì»¬ ìŠ¤í† ë¦¬ì§€ì—ì„œ ë¶ˆëŸ¬ì˜¤ê¸°
        function loadFromLocalStorage() {
            // ëˆ„ì  ê¸°ë¡ ë¶ˆëŸ¬ì˜¤ê¸°
            const allData = localStorage.getItem('attendance_all');
            if (allData) {
                allRecords = JSON.parse(allData);
            }
        }
        
        // ì‘ì—… ë‚ ì§œ ì´ˆê¸°í™”
        function resetToday() {
            const workingDateString = workingDate.toLocaleDateString('ko-KR', {
                month: 'long',
                day: 'numeric',
                weekday: 'long'
            });
            
            if (confirm(`${workingDateString}ì˜ ì¶œê²°ì„ ëª¨ë‘ ì´ˆê¸°í™”í•˜ì‹œê² ìŠµë‹ˆê¹Œ?`)) {
                todayAttendance = {};
                
                // ëª¨ë“  í•™ìƒì„ ì •ìƒìœ¼ë¡œ ì´ˆê¸°í™”
                for (let i = 1; i <= 35; i++) {
                    const card = document.getElementById(`student-${i}`);
                    const statusDiv = document.getElementById(`status-${i}`);
                    
                    card.classList.remove('absent', 'late', 'early-leave');
                    statusDiv.textContent = '';
                }
                
                updateTodayStats();
                saveWorkingDateData();
                
                // ë‹¬ë ¥ì´ ì‘ì—… ë‚ ì§œë¥¼ ë³´ì—¬ì£¼ê³  ìˆë‹¤ë©´ ì—…ë°ì´íŠ¸
                if (selectedDate.toDateString() === workingDate.toDateString()) {
                    loadWorkingDateData();
                }
                
                createCalendar();
                showMessage('ì¶œê²°ì´ ì´ˆê¸°í™”ë˜ì—ˆìŠµë‹ˆë‹¤.');
            }
        }
        
        // ëª¨ë“  ë°ì´í„° ì´ˆê¸°í™”
        function resetAllData() {
            if (confirm('âš ï¸ ê²½ê³ : ëª¨ë“  ë‚ ì§œì˜ ì¶œê²° ê¸°ë¡ì´ ì™„ì „íˆ ì‚­ì œë©ë‹ˆë‹¤.\n\nì •ë§ë¡œ ëª¨ë“  ë°ì´í„°ë¥¼ ì´ˆê¸°í™”í•˜ì‹œê² ìŠµë‹ˆê¹Œ?')) {
                if (confirm('í•œë²ˆ ë” í™•ì¸í•©ë‹ˆë‹¤. ì •ë§ë¡œ ëª¨ë“  ì¶œê²° ê¸°ë¡ì„ ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?\n\nì´ ì‘ì—…ì€ ë˜ëŒë¦´ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.')) {
                    // ëª¨ë“  ë°ì´í„° ì´ˆê¸°í™”
                    todayAttendance = {};
                    allRecords = {};
                    
                    // ë¡œì»¬ ìŠ¤í† ë¦¬ì§€ ëª¨ë“  ì¶œê²° ë°ì´í„° ì‚­ì œ
                    const keys = Object.keys(localStorage);
                    keys.forEach(key => {
                        if (key.startsWith('attendance_')) {
                            localStorage.removeItem(key);
                        }
                    });
                    
                    // í˜„ì¬ í™”ë©´ ì´ˆê¸°í™”
                    for (let i = 1; i <= 35; i++) {
                        const card = document.getElementById(`student-${i}`);
                        const statusDiv = document.getElementById(`status-${i}`);
                        
                        card.classList.remove('absent', 'late', 'early-leave');
                        statusDiv.textContent = '';
                    }
                    
                    updateTodayStats();
                    createCalendar();
                    
                    alert('âœ… ëª¨ë“  ì¶œê²° ê¸°ë¡ì´ ì‚­ì œë˜ì—ˆìŠµë‹ˆë‹¤.');
                }
            }
        }
        
        // ë¡œì»¬ ìŠ¤í† ë¦¬ì§€ì—ì„œ ì˜¤ëŠ˜ ë°ì´í„° ë³µì›
        function restoreTodayData() {
            const today = new Date().toLocaleDateString('ko-KR');
            const todayData = localStorage.getItem(`attendance_${today}`);
            
            if (todayData) {
                todayAttendance = JSON.parse(todayData);
                
                // í™”ë©´ì— ë°˜ì˜
                Object.keys(todayAttendance).forEach(studentNumber => {
                    const record = todayAttendance[studentNumber];
                    const card = document.getElementById(`student-${studentNumber}`);
                    const statusDiv = document.getElementById(`status-${studentNumber}`);
                    
                    if (card && statusDiv) {
                        card.classList.remove('absent', 'late', 'early-leave');
                        card.classList.add(record.status);
                        statusDiv.textContent = `${getStatusKorean(record.status)} (${record.time})`;
                    }
                });
                
                updateTodayStats();
            }
        }
        
        // íƒ­ ì „í™˜ ê¸°ëŠ¥
        function switchTab(tabName) {
            // ëª¨ë“  íƒ­ ì»¨í…ì¸  ìˆ¨ê¸°ê¸°
            document.querySelectorAll('.tab-content').forEach(content => {
                content.classList.remove('active');
            });
            
            // ëª¨ë“  íƒ­ ë²„íŠ¼ ë¹„í™œì„±í™”
            document.querySelectorAll('.tab-btn').forEach(btn => {
                btn.classList.remove('active');
            });
            
            // ì„ íƒëœ íƒ­ ì»¨í…ì¸  ë³´ì´ê¸°
            document.getElementById(tabName + '-content').classList.add('active');
            
            // ì„ íƒëœ íƒ­ ë²„íŠ¼ í™œì„±í™”
            document.getElementById(tabName + '-tab').classList.add('active');
            
            // ë¬¸ìë°œì†¡ íƒ­ìœ¼ë¡œ ì „í™˜ì‹œ ìë™ìœ¼ë¡œ ì „ì²´ ëŒ€ìƒì ë¡œë”©
            if (tabName === 'sms') {
                loadAllAbsentStudents();
            }
        }

        // ë¬¸ìë°œì†¡ ê´€ë ¨ í•¨ìˆ˜ë“¤
        let smsData = [];
        let allSMSRecords = {}; // ë‚ ì§œë³„ ë¬¸ìë°œì†¡ ê¸°ë¡ ì €ì¥

        // ì „ì²´ ì¶œê²° ëŒ€ìƒì ë¶ˆëŸ¬ì˜¤ê¸° (ê²°ì„, ì§€ê°, ì¡°í‡´)
        function loadAllAbsentStudents() {
            smsData = [];
            let idCounter = 0;
            
            // ê¸°ì¡´ ë¬¸ìë°œì†¡ ê¸°ë¡ ë¶ˆëŸ¬ì˜¤ê¸°
            loadSMSRecords();
            
            // ëª¨ë“  ë‚ ì§œì˜ ì¶œê²° ê¸°ë¡ì—ì„œ ëŒ€ìƒì ì°¾ê¸°
            Object.keys(allRecords).forEach(dateKey => {
                const dayRecords = allRecords[dateKey];
                
                Object.keys(dayRecords).forEach(studentNumber => {
                    const record = dayRecords[studentNumber];
                    
                    // ê²°ì„, ì§€ê°, ì¡°í‡´, ê²°ê³¼ ëª¨ë‘ í¬í•¨
                    if (['absent', 'late', 'early-leave', 'absent-early'].includes(record.status)) {
                        const verificationType = record.verificationType || 'verified';
                        let statusText = '';
                        let statusEmoji = '';
                        
                        // ê°„ê²°í•œ ìœ í˜• í‘œì‹œ
                        if (verificationType === 'medical') {
                            statusText = 'ì§ˆë³‘';
                            statusEmoji = 'ğŸ¥';
                        } else if (verificationType === 'unverified') {
                            statusText = 'ë¯¸ì¸ì •';
                            statusEmoji = 'âš ï¸';
                        } else {
                            statusText = 'ì¸ì •';
                            statusEmoji = 'âœ…';
                        }
                        
                        // ê³ ìœ  í‚¤ ìƒì„± (ë‚ ì§œ_í•™ìƒë²ˆí˜¸_ìƒíƒœ)
                        const uniqueKey = `${dateKey}_${studentNumber}_${record.status}`;
                        
                        // ì´ë¯¸ ë°œì†¡ëœ ê¸°ë¡ì¸ì§€ í™•ì¸
                        const sentRecord = allSMSRecords[uniqueKey];
                        const isSent = sentRecord ? sentRecord.sent : false;
                        
                        // ì‹¤ì œ í•™ìƒ ì •ë³´ ê°€ì ¸ì˜¤ê¸°
                        const studentInfo = getStudentInfo(studentNumber);
                        
                        smsData.push({
                            id: ++idCounter,
                            uniqueKey: uniqueKey,
                            studentNumber: studentNumber,
                            name: studentInfo.name,
                            phone: studentInfo.phone,
                            date: dateKey,
                            status: statusText,
                            statusEmoji: statusEmoji,
                            period: record.period || '',
                            verificationType: verificationType,
                            originalStatus: record.status,
                            lateCount: 1, // ì‹¤ì œë¡œëŠ” ëˆ„ì  íšŸìˆ˜ ê³„ì‚° í•„ìš”
                            totalCount: 1,
                            sendStatus: 'ì‹¤í–‰',
                            sent: isSent,
                            selected: verificationType === 'unverified' && !isSent // ë¯¸ì¸ì •ì´ë©´ì„œ ë°œì†¡ì•ˆëœ ê²ƒë§Œ ê¸°ë³¸ ì„ íƒ
                        });
                    }
                });
            });
            
            // ë‚ ì§œìˆœìœ¼ë¡œ ì •ë ¬ (ìµœì‹  ë‚ ì§œê°€ ìœ„ë¡œ)
            smsData.sort((a, b) => {
                const dateA = new Date(a.date.replace(/\./g, '/'));
                const dateB = new Date(b.date.replace(/\./g, '/'));
                return dateB - dateA;
            });
            
            updateSMSTable();
            showMessage(`${smsData.length}ëª…ì˜ ì¶œê²° ëŒ€ìƒìë¥¼ ë¶ˆëŸ¬ì™”ìŠµë‹ˆë‹¤.`);
        }

        // ë¯¸ì¸ì •ì§€ê° í•™ìƒë§Œ ë¶ˆëŸ¬ì˜¤ê¸°
        function loadUnverifiedLateStudents() {
            smsData = [];
            const today = workingDate.toLocaleDateString('ko-KR');
            
            // í˜„ì¬ ì‘ì—…ì¼ì˜ ë¯¸ì¸ì •ì§€ê° í•™ìƒë“¤ë§Œ ì°¾ê¸°
            Object.keys(todayAttendance).forEach(studentNumber => {
                const record = todayAttendance[studentNumber];
                if (record.status === 'late' && record.verificationType === 'unverified') {
                    smsData.push({
                        id: smsData.length + 1,
                        studentNumber: studentNumber,
                        name: `í•™ìƒ${studentNumber}`,
                        phone: '010-0000-0000',
                        date: today,
                        status: 'ë¯¸ì¸ì •ì§€ê°',
                        statusEmoji: 'âš ï¸',
                        period: record.period || '',
                        verificationType: 'unverified',
                        originalStatus: 'late',
                        lateCount: 1,
                        totalCount: 1,
                        teacher: '3-2ë°˜ ë‹´ì„',
                        sendStatus: 'ì‹¤í–‰',
                        sent: false,
                        selected: true
                    });
                }
            });
            
            updateSMSTable();
            showMessage(`${smsData.length}ëª…ì˜ ë¯¸ì¸ì •ì§€ê° í•™ìƒì„ ë¶ˆëŸ¬ì™”ìŠµë‹ˆë‹¤.`);
        }

        // SMS í…Œì´ë¸” ì—…ë°ì´íŠ¸
        function updateSMSTable() {
            const tbody = document.getElementById('smsTableBody');
            tbody.innerHTML = '';
            
            smsData.forEach(student => {
                const row = document.createElement('tr');
                if (student.selected) {
                    row.classList.add('selected');
                }
                
                // ìƒíƒœì— ë”°ë¥¸ CSS í´ë˜ìŠ¤ ê²°ì •
                let statusClass = 'status-late'; // ê¸°ë³¸ê°’
                if (student.verificationType === 'medical') {
                    statusClass = 'status-medical';
                } else if (student.verificationType === 'verified') {
                    statusClass = 'status-verified';
                } else if (student.verificationType === 'unverified') {
                    statusClass = 'status-unverified';
                }
                
                // ê¸°ë³¸ ìƒíƒœëª… ë§¤í•‘
                const baseStatusNames = {
                    'absent': 'ê²°ì„',
                    'late': 'ì§€ê°',
                    'early-leave': 'ì¡°í‡´',
                    'absent-early': 'ê²°ê³¼'
                };
                
                // ì¢…ë¥˜ëª… ë§¤í•‘
                const typeNames = {
                    'medical': 'ì§ˆë³‘',
                    'verified': 'ì¸ì •',
                    'unverified': 'ë¯¸ì¸ì •'
                };
                
                const baseStatus = baseStatusNames[student.originalStatus] || student.originalStatus;
                const typeName = typeNames[student.verificationType] || student.verificationType;
                
                // ì‹œì‘/ì¢…ë£Œ êµì‹œ ê³„ì‚°
                let startPeriod = '';
                let endPeriod = '';
                
                // ìƒˆë¡œìš´ ë²”ìœ„ ë°©ì‹ì˜ ë°ì´í„°ì¸ì§€ í™•ì¸
                if (student.startPeriod !== undefined && student.endPeriod !== undefined) {
                    // ìƒˆë¡œìš´ ë²”ìœ„ ë°©ì‹
                    startPeriod = student.startPeriod === 0 ? '0' : student.startPeriod.toString();
                    endPeriod = student.endPeriod === 0 ? '0' : student.endPeriod.toString();
                } else if (student.period) {
                    // ê¸°ì¡´ ë°©ì‹ ë˜ëŠ” ë²”ìœ„ ê°ì²´
                    if (typeof student.period === 'object' && student.period.start !== undefined && student.period.end !== undefined) {
                        // ë²”ìœ„ ê°ì²´
                        startPeriod = student.period.start === 0 ? '0' : student.period.start.toString();
                        endPeriod = student.period.end === 0 ? '0' : student.period.end.toString();
                    } else {
                        // ê¸°ì¡´ ë‹¨ì¼ êµì‹œ ë°©ì‹ (ë¬¸ìì—´ ì•ˆì „ ì²˜ë¦¬)
                        const periodStr = String(student.period);
                        if (student.originalStatus === 'absent') {
                            // ê²°ì„: 1êµì‹œë¶€í„° í•´ë‹¹ êµì‹œê¹Œì§€
                            startPeriod = '1';
                            endPeriod = periodStr.replace('êµì‹œ', '').replace('ì¡°ë¡€', '0');
                        } else if (student.originalStatus === 'late') {
                            // ì§€ê°: í•´ë‹¹ êµì‹œë¶€í„° ë§ˆì§€ë§‰ êµì‹œê¹Œì§€
                            startPeriod = periodStr.replace('êµì‹œ', '').replace('ì¡°ë¡€', '0');
                            endPeriod = '7'; // ë³´í†µ 7êµì‹œê¹Œì§€
                        } else if (student.originalStatus === 'early-leave') {
                            // ì¡°í‡´: í•´ë‹¹ êµì‹œë¶€í„° ë§ˆì§€ë§‰ êµì‹œê¹Œì§€
                            startPeriod = periodStr.replace('êµì‹œ', '').replace('ì¡°ë¡€', '0');
                            endPeriod = '7';
                        } else if (student.originalStatus === 'absent-early') {
                            // ê²°ê³¼: 1êµì‹œë¶€í„° í•´ë‹¹ êµì‹œê¹Œì§€
                            startPeriod = '1';
                            endPeriod = periodStr.replace('êµì‹œ', '').replace('ì¡°ë¡€', '0');
                        }
                    }
                }
                
                row.innerHTML = `
                    <td>${student.studentNumber}</td>
                    <td>${student.name}</td>
                    <td>${student.phone}</td>
                    <td>${student.date}</td>
                    <td><span class="${statusClass}">${student.statusEmoji} ${baseStatus}</span></td>
                    <td>${typeName}</td>
                    <td>${startPeriod === '0' ? 'ì¡°íšŒ' : startPeriod}</td>
                    <td>${endPeriod === '0' ? 'ì¡°íšŒ' : endPeriod}</td>
                    <td>
                        ${student.sent ? 
                            '<span class="status-sent">ë°œì†¡ì™„ë£Œ</span>' : 
                            `<button class="send-btn" onclick="sendWebhook(${student.id}, '${student.status}', '${student.studentNumber}')">ë°œì†¡</button>`
                        }
                    </td>
                    <td>${student.sent ? '<span class="status-sent">âœ“</span>' : ''}</td>
                `;
                
                tbody.appendChild(row);
            });
        }

        // í•™ìƒ ì„ íƒ/í•´ì œ
        function toggleStudentSelection(studentId) {
            const student = smsData.find(s => s.id === studentId);
            if (student) {
                student.selected = !student.selected;
                updateSMSTable();
            }
        }

        // ì„ íƒëœ í•™ìƒë“¤ì—ê²Œ SMS ë°œì†¡
        function sendSelectedSMS() {
            const selectedStudents = smsData.filter(s => s.selected && !s.sent);
            
            if (selectedStudents.length === 0) {
                alert('ë°œì†¡í•  í•™ìƒì„ ì„ íƒí•´ì£¼ì„¸ìš”.');
                return;
            }
            
            if (confirm(`ì„ íƒëœ ${selectedStudents.length}ëª…ì—ê²Œ ë¬¸ìë¥¼ ë°œì†¡í•˜ì‹œê² ìŠµë‹ˆê¹Œ?`)) {
                // ì‹¤ì œ SMS ë°œì†¡ ë¡œì§ì€ ì—¬ê¸°ì— êµ¬í˜„
                selectedStudents.forEach(student => {
                    student.sent = true;
                    student.selected = false;
                });
                
                updateSMSTable();
                alert(`${selectedStudents.length}ëª…ì—ê²Œ ë¬¸ìê°€ ë°œì†¡ë˜ì—ˆìŠµë‹ˆë‹¤.`);
            }
        }

        // SMS ëª©ë¡ ì´ˆê¸°í™”
        function clearSMSList() {
            if (confirm('ë¬¸ìë°œì†¡ ëª©ë¡ì„ ì´ˆê¸°í™”í•˜ì‹œê² ìŠµë‹ˆê¹Œ?')) {
                smsData = [];
                updateSMSTable();
            }
        }

        // ë¬¸ìë°œì†¡ ê¸°ë¡ ì €ì¥/ë¶ˆëŸ¬ì˜¤ê¸°
        function saveSMSRecords() {
            localStorage.setItem('sms_records_all', JSON.stringify(allSMSRecords));
        }

        function loadSMSRecords() {
            const savedData = localStorage.getItem('sms_records_all');
            if (savedData) {
                allSMSRecords = JSON.parse(savedData);
            }
        }

        // ì „ì—­ ë³€ìˆ˜ë¡œ í˜„ì¬ ë°œì†¡í•  í•™ìƒ ì •ë³´ ì €ì¥
        let currentSendingStudent = null;
        
        // ì›¹í›…ìœ¼ë¡œ ë¬¸ì ë°œì†¡ - ë¯¸ë¦¬ë³´ê¸° í‘œì‹œ
        function sendWebhook(studentId, status, studentNumber) {
            const student = smsData.find(s => s.id === studentId);
            if (!student) {
                alert('í•™ìƒ ì •ë³´ë¥¼ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.');
                return;
            }

            if (student.sent) {
                alert('ì´ë¯¸ ë°œì†¡ëœ í•™ìƒì…ë‹ˆë‹¤.');
                return;
            }

            // í˜„ì¬ ë°œì†¡í•  í•™ìƒ ì •ë³´ ì €ì¥
            currentSendingStudent = student;
            
            // ë¯¸ë¦¬ë³´ê¸° ëª¨ë‹¬ í‘œì‹œ
            showSMSPreview(student);
        }
        
        // SMS ë¯¸ë¦¬ë³´ê¸° í‘œì‹œ
        function showSMSPreview(student) {
            const message = processTemplate(student);
            
            document.getElementById('previewRecipient').textContent = `${student.studentNumber}ë²ˆ ${student.name} ë³´í˜¸ì`;
            document.getElementById('previewPhone').textContent = student.phone || 'ì—°ë½ì²˜ ì—†ìŒ';
            document.getElementById('previewSender').textContent = senderName || 'ë°œì‹ ì ë¯¸ì„¤ì •';
            document.getElementById('previewMessage').textContent = message;
            
            document.getElementById('smsPreviewModal').style.display = 'block';
        }
        
        // SMS ë¯¸ë¦¬ë³´ê¸° ë‹«ê¸°
        function closeSMSPreview() {
            document.getElementById('smsPreviewModal').style.display = 'none';
            currentSendingStudent = null;
        }
        
        // ì‹¤ì œ SMS ë°œì†¡ í™•ì¸
        async function confirmSendSMS() {
            if (!currentSendingStudent) {
                alert('ë°œì†¡í•  í•™ìƒ ì •ë³´ê°€ ì—†ìŠµë‹ˆë‹¤.');
                return;
            }
            
            // í•™ìƒ ì •ë³´ ë³µì‚¬ (ì°¸ì¡° ì•ˆì „ì„±)
            const studentCopy = { ...currentSendingStudent };
            
            closeSMSPreview();
            
            // ì‹¤ì œ ë°œì†¡ ì²˜ë¦¬
            await performSMSSend(studentCopy);
        }
        
        // ì‹¤ì œ SMS ë°œì†¡ ì²˜ë¦¬
        async function performSMSSend(student) {

            try {
                // í•™ìƒ ì •ë³´ ê²€ì¦
                if (!student) {
                    alert('í•™ìƒ ì •ë³´ê°€ ì—†ìŠµë‹ˆë‹¤.');
                    return;
                }
                
                // í•„ìˆ˜ í•„ë“œ ê²€ì¦
                if (!student.name || !student.phone || !student.studentNumber) {
                    alert('í•™ìƒ ì •ë³´ê°€ ë¶ˆì™„ì „í•©ë‹ˆë‹¤.');
                    return;
                }
                
                // í…œí”Œë¦¿ ì²˜ë¦¬ëœ ë©”ì‹œì§€ ìƒì„±
                const message = processTemplate(student);
                
                // ì†”ë¼í”¼ ì„¤ì • í™•ì¸
                if (!solapiApiKey || !solapiSecretKey || !senderPhone) {
                    alert('ì†”ë¼í”¼ API ì„¤ì •ì´ í•„ìš”í•©ë‹ˆë‹¤. âš™ï¸ ì†”ë¼í”¼ ì„¤ì •ì—ì„œ API ì •ë³´ë¥¼ ì…ë ¥í•´ì£¼ì„¸ìš”.');
                    return;
                }

                // ì†”ë¼í”¼ ì¸ì¦ ì •ë³´ ìƒì„±
                const date = new Date().toISOString();
                const salt = Math.random().toString(36).substring(2, 15) + Math.random().toString(36).substring(2, 15);
                const data = date + salt;
                
                // HMAC-SHA256 ì„œëª… ìƒì„± (ë¸Œë¼ìš°ì €ìš© ê°„ë‹¨ ë²„ì „)
                const signature = await generateHMAC(solapiSecretKey, data);
                
                // ì†”ë¼í”¼ API ë°ì´í„° ì¤€ë¹„
                const solapiData = {
                    message: {
                        to: student.phone.replace(/-/g, ''), // í•˜ì´í”ˆ ì œê±°
                        from: senderPhone.replace(/-/g, ''), // í•˜ì´í”ˆ ì œê±°
                        text: message
                    }
                };
                
                // ì†”ë¼í”¼ API ì§ì ‘ í˜¸ì¶œ
                const response = await fetch('https://api.solapi.com/messages/v4/send', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                        'Authorization': `HMAC-SHA256 apiKey=${solapiApiKey}, date=${date}, salt=${salt}, signature=${signature}`
                    },
                    body: JSON.stringify(solapiData)
                });

                if (response.ok) {
                    // ì›ë³¸ smsDataì—ì„œ í•´ë‹¹ í•™ìƒ ì°¾ì•„ì„œ ì—…ë°ì´íŠ¸
                    const originalStudent = smsData.find(s => s.id === student.id);
                    if (originalStudent) {
                        originalStudent.sent = true;
                        originalStudent.selected = false;
                    }
                    
                    // ë°œì†¡ ê¸°ë¡ì„ allSMSRecordsì— ì €ì¥
                    allSMSRecords[student.uniqueKey] = {
                        sent: true,
                        sentTime: new Date().toISOString(),
                        webhookResponse: 'success'
                    };
                    saveSMSRecords();
                    
                    updateSMSTable();
                    alert(`${student.studentNumber}ë²ˆ í•™ìƒì—ê²Œ ë¬¸ìê°€ ë°œì†¡ë˜ì—ˆìŠµë‹ˆë‹¤.`);
                } else {
                    throw new Error(`HTTP ${response.status}: ${response.statusText}`);
                }

            } catch (error) {
                console.error('ì›¹í›… ë°œì†¡ ì‹¤íŒ¨:', error);
                
                // ê°œë°œ/í…ŒìŠ¤íŠ¸ìš© - ì‹¤ì œë¡œëŠ” ì›¹í›…ì´ ì—†ì–´ë„ ì„±ê³µìœ¼ë¡œ ì²˜ë¦¬
                if (confirm('ì†”ë¼í”¼ API ì—°ê²°ì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤. í…ŒìŠ¤íŠ¸ ëª¨ë“œë¡œ ë°œì†¡ ì²˜ë¦¬í•˜ì‹œê² ìŠµë‹ˆê¹Œ?')) {
                    // ì›ë³¸ smsDataì—ì„œ í•´ë‹¹ í•™ìƒ ì°¾ì•„ì„œ ì—…ë°ì´íŠ¸
                    const originalStudent = smsData.find(s => s.id === student.id);
                    if (originalStudent) {
                        originalStudent.sent = true;
                        originalStudent.selected = false;
                    }
                    
                    // í…ŒìŠ¤íŠ¸ ëª¨ë“œ ë°œì†¡ ê¸°ë¡ë„ ì €ì¥
                    allSMSRecords[student.uniqueKey] = {
                        sent: true,
                        sentTime: new Date().toISOString(),
                        webhookResponse: 'test_mode'
                    };
                    saveSMSRecords();
                    
                    updateSMSTable();
                    alert(`${student.studentNumber}ë²ˆ í•™ìƒì—ê²Œ ë¬¸ìê°€ ë°œì†¡ë˜ì—ˆìŠµë‹ˆë‹¤. (í…ŒìŠ¤íŠ¸ ëª¨ë“œ)`);
                } else {
                    alert('ë¬¸ì ë°œì†¡ì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤: ' + error.message);
                }
            }
        }

        // ì›¹í›… URL ì„¤ì • (ì‹¤ì œ ì‚¬ìš©ì‹œ ìˆ˜ì • í•„ìš”)
        let webhookUrl = 'https://your-webhook-service.com/send-sms';

        // ì†”ë¼í”¼ API ì„¤ì •
        let solapiApiKey = '';
        let solapiSecretKey = '';
        let senderPhone = '';
        
        // ì†”ë¼í”¼ API ì„¤ì • í•¨ìˆ˜
        function setWebhookUrl() {
            const modal = document.createElement('div');
            modal.style.cssText = `
                position: fixed; top: 0; left: 0; width: 100%; height: 100%;
                background: rgba(0,0,0,0.5); display: flex; justify-content: center; align-items: center;
                z-index: 1000;
            `;
            
            modal.innerHTML = `
                <div style="background: white; padding: 20px; border-radius: 8px; width: 400px;">
                    <h3>ğŸ“± ì†”ë¼í”¼ API ì„¤ì •</h3>
                    <div style="margin-bottom: 15px;">
                        <label>API Key:</label><br>
                        <input type="text" id="apiKey" value="${solapiApiKey}" style="width: 100%; padding: 5px; margin-top: 5px;">
                    </div>
                    <div style="margin-bottom: 15px;">
                        <label>Secret Key:</label><br>
                        <input type="password" id="secretKey" value="${solapiSecretKey}" style="width: 100%; padding: 5px; margin-top: 5px;">
                    </div>
                    <div style="margin-bottom: 15px;">
                        <label>ë°œì‹ ë²ˆí˜¸:</label><br>
                        <input type="text" id="senderPhone" value="${senderPhone}" placeholder="010-0000-0000" style="width: 100%; padding: 5px; margin-top: 5px;">
                    </div>
                    <div style="text-align: center;">
                        <button onclick="saveSolapiSettings()" style="background: #007bff; color: white; padding: 8px 15px; border: none; border-radius: 4px; margin-right: 10px;">ì €ì¥</button>
                        <button onclick="closeSolapiModal()" style="background: #6c757d; color: white; padding: 8px 15px; border: none; border-radius: 4px;">ì·¨ì†Œ</button>
                    </div>
                </div>
            `;
            
            document.body.appendChild(modal);
            window.currentSolapiModal = modal;
        }
        
        function saveSolapiSettings() {
            solapiApiKey = document.getElementById('apiKey').value.trim();
            solapiSecretKey = document.getElementById('secretKey').value.trim();
            senderPhone = document.getElementById('senderPhone').value.trim();
            
            if (!solapiApiKey || !solapiSecretKey || !senderPhone) {
                alert('ëª¨ë“  í•„ë“œë¥¼ ì…ë ¥í•´ì£¼ì„¸ìš”.');
                return;
            }
            
            localStorage.setItem('solapi_api_key', solapiApiKey);
            localStorage.setItem('solapi_secret_key', solapiSecretKey);
            localStorage.setItem('solapi_sender_phone', senderPhone);
            
            alert('ì†”ë¼í”¼ API ì„¤ì •ì´ ì €ì¥ë˜ì—ˆìŠµë‹ˆë‹¤.');
            closeSolapiModal();
        }
        
        function closeSolapiModal() {
            if (window.currentSolapiModal) {
                document.body.removeChild(window.currentSolapiModal);
                window.currentSolapiModal = null;
            }
        }

        // ì†”ë¼í”¼ ì„¤ì • ë¶ˆëŸ¬ì˜¤ê¸°
        function loadWebhookUrl() {
            const savedApiKey = localStorage.getItem('solapi_api_key');
            const savedSecretKey = localStorage.getItem('solapi_secret_key');
            const savedSenderPhone = localStorage.getItem('solapi_sender_phone');
            
            if (savedApiKey) solapiApiKey = savedApiKey;
            if (savedSecretKey) solapiSecretKey = savedSecretKey;
            if (savedSenderPhone) senderPhone = savedSenderPhone;
        }

        // ë¬¸ì í…œí”Œë¦¿ ê´€ë ¨ ë³€ìˆ˜ë“¤
        let smsTemplates = {
            absent: `[ìë™ë°œì†¡]
ì•ˆë…•í•˜ì„¸ìš”, {{ì´ë¦„}} ë³´í˜¸ìë‹˜.
{{ì´ë¦„}} í•™ìƒì´ ì•„ë˜ì™€ ê°™ì´ ê²°ì„í•˜ì˜€ìŠµë‹ˆë‹¤. 
â€”â€”â€”â€”â€”â€”
-ë‚ ì§œ: {{ë‚ ì§œ}}
-êµì‹œ: {{ì‹œì‘}}êµì‹œ~{{ë}}êµì‹œê¹Œì§€ 
-ì¢…ë¥˜: {{ì¢…ë¥˜}}
â€”â€”â€”â€”â€”â€”â€”
ê¶ê¸ˆí•œ ì‚¬í•­ì´ ìˆìœ¼ì‹œë©´ ì—°ë½í•´ ì£¼ì„¸ìš”.  
ê°ì‚¬í•©ë‹ˆë‹¤.
-{{ë°œì‹ ìëª…}} ë“œë¦¼

*ì¶œê²°ì‹ ê³ ì„œ ë¶€íƒë“œë¦½ë‹ˆë‹¤.(ë¯¸ì¸ì • ì œì™¸)`,

            late: `[ìë™ë°œì†¡]
ì•ˆë…•í•˜ì„¸ìš”, {{ì´ë¦„}} ë³´í˜¸ìë‹˜.
{{ì´ë¦„}} í•™ìƒì´ ì•„ë˜ì™€ ê°™ì´ ì§€ê°í•˜ì˜€ìŠµë‹ˆë‹¤. 
â€”â€”â€”â€”â€”â€”
-ë‚ ì§œ: {{ë‚ ì§œ}}
-êµì‹œ: {{ì‹œì‘}}êµì‹œ~{{ë}}êµì‹œê¹Œì§€ 
-ì¢…ë¥˜: {{ì¢…ë¥˜}}
â€”â€”â€”â€”â€”â€”â€”
ê¶ê¸ˆí•œ ì‚¬í•­ì´ ìˆìœ¼ì‹œë©´ ì—°ë½í•´ ì£¼ì„¸ìš”.  
ê°ì‚¬í•©ë‹ˆë‹¤.
-{{ë°œì‹ ìëª…}} ë“œë¦¼

*ì¶œê²°ì‹ ê³ ì„œ ë¶€íƒë“œë¦½ë‹ˆë‹¤.(ë¯¸ì¸ì • ì œì™¸)`,

            'early-leave': `[ìë™ë°œì†¡]
ì•ˆë…•í•˜ì„¸ìš”, {{ì´ë¦„}} ë³´í˜¸ìë‹˜.
{{ì´ë¦„}} í•™ìƒì´ ì•„ë˜ì™€ ê°™ì´ ì¡°í‡´í•˜ì˜€ìŠµë‹ˆë‹¤. 
â€”â€”â€”â€”â€”â€”
-ë‚ ì§œ: {{ë‚ ì§œ}}
-êµì‹œ: {{ì‹œì‘}}êµì‹œ~{{ë}}êµì‹œ
-ì¢…ë¥˜: {{ì¢…ë¥˜}}
â€”â€”â€”â€”â€”â€”â€”
ê¶ê¸ˆí•œ ì‚¬í•­ì´ ìˆìœ¼ì‹œë©´ ë¬¸ì˜í•´ ì£¼ì„¸ìš”.  
ê°ì‚¬í•©ë‹ˆë‹¤.
-{{ë°œì‹ ìëª…}} ë“œë¦¼

*ì¶œê²°ì‹ ê³ ì„œ ë¶€íƒë“œë¦½ë‹ˆë‹¤.(ë¯¸ì¸ì • ì œì™¸)`,

            'absent-early': `[ìë™ë°œì†¡]
ì•ˆë…•í•˜ì„¸ìš”, {{ì´ë¦„}} ë³´í˜¸ìë‹˜.
{{ì´ë¦„}} í•™ìƒì´ ì•„ë˜ì™€ ê°™ì´ ê²°ê³¼í•˜ì˜€ìŠµë‹ˆë‹¤. 
â€”â€”â€”â€”â€”â€”
-ë‚ ì§œ: {{ë‚ ì§œ}}
-êµì‹œ: {{ì‹œì‘}}êµì‹œ~{{ë}}êµì‹œê¹Œì§€ 
-ì¢…ë¥˜: {{ì¢…ë¥˜}}
â€”â€”â€”â€”â€”â€”â€”
ê¶ê¸ˆí•œ ì‚¬í•­ì´ ìˆìœ¼ì‹œë©´ ì—°ë½í•´ ì£¼ì„¸ìš”.  
ê°ì‚¬í•©ë‹ˆë‹¤.
-{{ë°œì‹ ìëª…}} ë“œë¦¼

*ì¶œê²°ì‹ ê³ ì„œ ë¶€íƒë“œë¦½ë‹ˆë‹¤.(ë¯¸ì¸ì • ì œì™¸)`
        };

        let senderName = '3-2ë°˜ ë‹´ì„';
        let currentTemplateType = 'absent';

        // í…œí”Œë¦¿ íƒ­ ì „í™˜
        function switchTemplateTab(type) {
            // ëª¨ë“  íƒ­ ë¹„í™œì„±í™”
            document.querySelectorAll('.template-tab').forEach(tab => {
                tab.classList.remove('active');
            });
            document.querySelectorAll('.template-content').forEach(content => {
                content.classList.remove('active');
            });
            
            // ì„ íƒëœ íƒ­ í™œì„±í™”
            document.getElementById('tab-' + type).classList.add('active');
            document.getElementById('template-' + type).classList.add('active');
            
            currentTemplateType = type;
        }

        // í…œí”Œë¦¿ ì„¤ì • ëª¨ë‹¬ ì—´ê¸°
        function setSMSTemplate() {
            loadTemplate();
            switchTemplateTab('absent');
            document.getElementById('templateModal').style.display = 'block';
        }

        // í…œí”Œë¦¿ ëª¨ë‹¬ ë‹«ê¸°
        function closeTemplateModal() {
            document.getElementById('templateModal').style.display = 'none';
        }

        // í…œí”Œë¦¿ ì €ì¥
        function saveTemplate() {
            smsTemplates.absent = document.getElementById('templateAbsent').value;
            smsTemplates.late = document.getElementById('templateLate').value;
            smsTemplates['early-leave'] = document.getElementById('templateEarly').value;
            smsTemplates['absent-early'] = document.getElementById('templateAbsentEarly').value;
            senderName = document.getElementById('senderName').value;
            
            localStorage.setItem('sms_templates', JSON.stringify(smsTemplates));
            localStorage.setItem('sms_sender_name', senderName);
            
            alert('í…œí”Œë¦¿ì´ ì €ì¥ë˜ì—ˆìŠµë‹ˆë‹¤.');
            closeTemplateModal();
        }

        // í…œí”Œë¦¿ ë¶ˆëŸ¬ì˜¤ê¸°
        function loadTemplate() {
            const savedTemplates = localStorage.getItem('sms_templates');
            const savedSender = localStorage.getItem('sms_sender_name');
            
            if (savedTemplates) {
                smsTemplates = JSON.parse(savedTemplates);
            }
            if (savedSender) {
                senderName = savedSender;
            }
            
            document.getElementById('templateAbsent').value = smsTemplates.absent;
            document.getElementById('templateLate').value = smsTemplates.late;
            document.getElementById('templateEarly').value = smsTemplates['early-leave'];
            document.getElementById('templateAbsentEarly').value = smsTemplates['absent-early'] || '';
            document.getElementById('senderName').value = senderName;
        }

        // ê¸°ë³¸ê°’ ë³µì›
        function resetTemplate() {
            if (confirm('ëª¨ë“  í…œí”Œë¦¿ì„ ê¸°ë³¸ê°’ìœ¼ë¡œ ë³µì›í•˜ì‹œê² ìŠµë‹ˆê¹Œ?')) {
                smsTemplates = {
                    absent: `[ìë™ë°œì†¡]
ì•ˆë…•í•˜ì„¸ìš”, {{ì´ë¦„}} ë³´í˜¸ìë‹˜.
{{ì´ë¦„}} í•™ìƒì´ ì•„ë˜ì™€ ê°™ì´ ê²°ì„í•˜ì˜€ìŠµë‹ˆë‹¤. 
â€”â€”â€”â€”â€”â€”
-ë‚ ì§œ: {{ë‚ ì§œ}}
-êµì‹œ: {{ì‹œì‘}}êµì‹œ~{{ë}}êµì‹œê¹Œì§€ 
-ì¢…ë¥˜: {{ì¢…ë¥˜}}
â€”â€”â€”â€”â€”â€”â€”
ê¶ê¸ˆí•œ ì‚¬í•­ì´ ìˆìœ¼ì‹œë©´ ì—°ë½í•´ ì£¼ì„¸ìš”.  
ê°ì‚¬í•©ë‹ˆë‹¤.
-{{ë°œì‹ ìëª…}} ë“œë¦¼

*ì¶œê²°ì‹ ê³ ì„œ ë¶€íƒë“œë¦½ë‹ˆë‹¤.(ë¯¸ì¸ì • ì œì™¸)`,

                    late: `[ìë™ë°œì†¡]
ì•ˆë…•í•˜ì„¸ìš”, {{ì´ë¦„}} ë³´í˜¸ìë‹˜.
{{ì´ë¦„}} í•™ìƒì´ ì•„ë˜ì™€ ê°™ì´ ì§€ê°í•˜ì˜€ìŠµë‹ˆë‹¤. 
â€”â€”â€”â€”â€”â€”
-ë‚ ì§œ: {{ë‚ ì§œ}}
-êµì‹œ: {{ì‹œì‘}}êµì‹œ~{{ë}}êµì‹œê¹Œì§€ 
-ì¢…ë¥˜: {{ì¢…ë¥˜}}
â€”â€”â€”â€”â€”â€”â€”
ê¶ê¸ˆí•œ ì‚¬í•­ì´ ìˆìœ¼ì‹œë©´ ì—°ë½í•´ ì£¼ì„¸ìš”.  
ê°ì‚¬í•©ë‹ˆë‹¤.
-{{ë°œì‹ ìëª…}} ë“œë¦¼

*ì¶œê²°ì‹ ê³ ì„œ ë¶€íƒë“œë¦½ë‹ˆë‹¤.(ë¯¸ì¸ì • ì œì™¸)`,

                    'early-leave': `[ìë™ë°œì†¡]
ì•ˆë…•í•˜ì„¸ìš”, {{ì´ë¦„}} ë³´í˜¸ìë‹˜.
{{ì´ë¦„}} í•™ìƒì´ ì•„ë˜ì™€ ê°™ì´ ì¡°í‡´í•˜ì˜€ìŠµë‹ˆë‹¤. 
â€”â€”â€”â€”â€”â€”
-ë‚ ì§œ: {{ë‚ ì§œ}}
-êµì‹œ: {{ì‹œì‘}}êµì‹œ~{{ë}}êµì‹œ
-ì¢…ë¥˜: {{ì¢…ë¥˜}}
â€”â€”â€”â€”â€”â€”â€”
ê¶ê¸ˆí•œ ì‚¬í•­ì´ ìˆìœ¼ì‹œë©´ ë¬¸ì˜í•´ ì£¼ì„¸ìš”.  
ê°ì‚¬í•©ë‹ˆë‹¤.
-{{ë°œì‹ ìëª…}} ë“œë¦¼

*ì¶œê²°ì‹ ê³ ì„œ ë¶€íƒë“œë¦½ë‹ˆë‹¤.(ë¯¸ì¸ì • ì œì™¸)`,

                    'absent-early': `[ìë™ë°œì†¡]
ì•ˆë…•í•˜ì„¸ìš”, {{ì´ë¦„}} ë³´í˜¸ìë‹˜.
{{ì´ë¦„}} í•™ìƒì´ ì•„ë˜ì™€ ê°™ì´ ê²°ê³¼í•˜ì˜€ìŠµë‹ˆë‹¤. 
â€”â€”â€”â€”â€”â€”
-ë‚ ì§œ: {{ë‚ ì§œ}}
-êµì‹œ: {{ì‹œì‘}}êµì‹œ~{{ë}}êµì‹œê¹Œì§€ 
-ì¢…ë¥˜: {{ì¢…ë¥˜}}
â€”â€”â€”â€”â€”â€”â€”
ê¶ê¸ˆí•œ ì‚¬í•­ì´ ìˆìœ¼ì‹œë©´ ì—°ë½í•´ ì£¼ì„¸ìš”.  
ê°ì‚¬í•©ë‹ˆë‹¤.
-{{ë°œì‹ ìëª…}} ë“œë¦¼

*ì¶œê²°ì‹ ê³ ì„œ ë¶€íƒë“œë¦½ë‹ˆë‹¤.(ë¯¸ì¸ì • ì œì™¸)`
                };
                senderName = '3-2ë°˜ ë‹´ì„';
                
                document.getElementById('templateAbsent').value = smsTemplates.absent;
                document.getElementById('templateLate').value = smsTemplates.late;
                document.getElementById('templateEarly').value = smsTemplates['early-leave'];
                document.getElementById('templateAbsentEarly').value = smsTemplates['absent-early'];
                document.getElementById('senderName').value = senderName;
            }
        }

        // í…œí”Œë¦¿ ë³€ìˆ˜ ì¹˜í™˜
        function processTemplate(student) {
            // ì¶œê²° ìƒíƒœì— ë”°ë¥¸ ì ì ˆí•œ í…œí”Œë¦¿ ì„ íƒ
            const templateType = student.originalStatus;
            let message = smsTemplates[templateType] || smsTemplates.absent;
            
            // ì‹œì‘/ì¢…ë£Œ êµì‹œ ê³„ì‚°
            let startPeriod = '';
            let endPeriod = '';
            
            if (student.period) {
                // periodê°€ ê°ì²´ì¸ ê²½ìš° ì²˜ë¦¬ (ë²”ìœ„ ì„ íƒ)
                let periodText = '';
                if (typeof student.period === 'object' && student.period.start !== undefined) {
                    // ë²”ìœ„ ì„ íƒì¸ ê²½ìš°
                    startPeriod = student.period.start === 0 ? '0' : student.period.start.toString();
                    endPeriod = student.period.end === 0 ? '0' : student.period.end.toString();
                } else if (typeof student.period === 'string') {
                    // ë¬¸ìì—´ì¸ ê²½ìš°
                    periodText = student.period;
                    if (student.originalStatus === 'absent') {
                        // ê²°ì„: 1êµì‹œë¶€í„° í•´ë‹¹ êµì‹œê¹Œì§€
                        startPeriod = '1';
                        endPeriod = periodText.replace('êµì‹œ', '').replace('ì¡°ë¡€', '0');
                    } else if (student.originalStatus === 'late') {
                        // ì§€ê°: í•´ë‹¹ êµì‹œë¶€í„° ë§ˆì§€ë§‰ êµì‹œê¹Œì§€
                        startPeriod = periodText.replace('êµì‹œ', '').replace('ì¡°ë¡€', '0');
                        endPeriod = '7'; // ë³´í†µ 7êµì‹œê¹Œì§€
                    } else if (student.originalStatus === 'early-leave') {
                        // ì¡°í‡´: í•´ë‹¹ êµì‹œë¶€í„° ë§ˆì§€ë§‰ êµì‹œê¹Œì§€
                        startPeriod = periodText.replace('êµì‹œ', '').replace('ì¡°ë¡€', '0');
                        endPeriod = '7';
                    } else if (student.originalStatus === 'absent-early') {
                        // ê²°ê³¼: 1êµì‹œë¶€í„° í•´ë‹¹ êµì‹œê¹Œì§€
                        startPeriod = '1';
                        endPeriod = periodText.replace('êµì‹œ', '').replace('ì¡°ë¡€', '0');
                    }
                }
            }
            
            // ë³€ìˆ˜ ì¹˜í™˜
            message = message.replace(/\{\{ì´ë¦„\}\}/g, student.name.replace('í•™ìƒ', ''));
            message = message.replace(/\{\{ë‚ ì§œ\}\}/g, student.date);
            message = message.replace(/\{\{ì¢…ë¥˜\}\}/g, student.status);
            message = message.replace(/\{\{ë°œì‹ ìëª…\}\}/g, senderName);
            
            // ê²°ì„ì˜ ê²½ìš° êµì‹œ ì •ë³´ ì™„ì „ ì œê±°
            if (student.originalStatus === 'absent') {
                message = message.replace(/-êµì‹œ:\s*\{\{ì‹œì‘\}\}êµì‹œ~\{\{ë\}\}êµì‹œê¹Œì§€\s*/g, '');
                message = message.replace(/-êµì‹œ:\s*\{\{ì‹œì‘\}\}êµì‹œ~\{\{ë\}\}êµì‹œ\s*/g, '');
                message = message.replace(/-êµì‹œ:\s*\n/g, '');
                message = message.replace(/-êµì‹œ:\s*/g, '');
                // ë‚¨ì€ í…œí”Œë¦¿ ë³€ìˆ˜ë„ ì œê±°
                message = message.replace(/\{\{ì‹œì‘\}\}/g, '');
                message = message.replace(/\{\{ë\}\}/g, '');
            } else {
                message = message.replace(/\{\{ì‹œì‘\}\}/g, startPeriod === '0' ? 'ì¡°ë¡€' : startPeriod);
                message = message.replace(/\{\{ë\}\}/g, endPeriod === '0' ? 'ì¡°ë¡€' : endPeriod);
            }
            
            return message;
        }

        // ë¸Œë¼ìš°ì €ìš© HMAC-SHA256 ìƒì„± í•¨ìˆ˜
        async function generateHMAC(secret, data) {
            const encoder = new TextEncoder();
            const key = await crypto.subtle.importKey(
                'raw',
                encoder.encode(secret),
                { name: 'HMAC', hash: 'SHA-256' },
                false,
                ['sign']
            );
            
            const signature = await crypto.subtle.sign('HMAC', key, encoder.encode(data));
            const hashArray = Array.from(new Uint8Array(signature));
            return hashArray.map(byte => byte.toString(16).padStart(2, '0')).join('');
        }

        // í•™ìƒ ë°ì´í„° ê´€ë¦¬
        let studentData = {};
        
        // í•™ìƒëª…ë‹¨ ì—…ë¡œë“œ ëª¨ë‹¬ ì—´ê¸°
        function uploadStudentData() {
            document.getElementById('studentUploadModal').style.display = 'block';
        }
        
        // í•™ìƒëª…ë‹¨ ì—…ë¡œë“œ ëª¨ë‹¬ ë‹«ê¸°
        function closeStudentUploadModal() {
            document.getElementById('studentUploadModal').style.display = 'none';
            document.getElementById('uploadResult').style.display = 'none';
        }
        
        // í•™ìƒëª…ë‹¨ í…œí”Œë¦¿ ë‹¤ìš´ë¡œë“œ (XLSX)
        function downloadStudentTemplate() {
            // ê°„ë‹¨í•œ HTML í…Œì´ë¸”ì„ XLSXë¡œ ë‹¤ìš´ë¡œë“œ
            const data = [
                ['ë²ˆí˜¸', 'ì´ë¦„', 'ì „í™”ë²ˆí˜¸'],
                [1, 'í™ê¸¸ë™', '010-1234-5678'],
                [2, 'ê¹€ì² ìˆ˜', '010-2345-6789'],
                [3, 'ì´ì˜í¬', '010-3456-7890']
            ];
            
            // ì—‘ì…€ìš© HTML ìƒì„±
            let html = '<table>';
            data.forEach(row => {
                html += '<tr>';
                row.forEach(cell => {
                    html += `<td>${cell}</td>`;
                });
                html += '</tr>';
            });
            html += '</table>';
            
            const blob = new Blob([html], { type: 'application/vnd.ms-excel' });
            const link = document.createElement('a');
            const url = URL.createObjectURL(blob);
            
            link.setAttribute('href', url);
            link.setAttribute('download', 'í•™ìƒëª…ë‹¨_ì–‘ì‹.xls');
            link.style.visibility = 'hidden';
            document.body.appendChild(link);
            link.click();
            document.body.removeChild(link);
            URL.revokeObjectURL(url);
        }
        
        // í•™ìƒëª…ë‹¨ íŒŒì¼ ì²˜ë¦¬
        function processStudentFile() {
            const fileInput = document.getElementById('studentFileInput');
            const file = fileInput.files[0];
            const resultDiv = document.getElementById('uploadResult');
            
            if (!file) {
                alert('íŒŒì¼ì„ ì„ íƒí•´ì£¼ì„¸ìš”.');
                return;
            }
            
            const fileName = file.name.toLowerCase();
            if (!fileName.endsWith('.csv') && !fileName.endsWith('.xlsx') && !fileName.endsWith('.xls')) {
                alert('CSV, XLS ë˜ëŠ” XLSX íŒŒì¼ë§Œ ì—…ë¡œë“œ ê°€ëŠ¥í•©ë‹ˆë‹¤.');
                return;
            }
            
            const reader = new FileReader();
            reader.onload = function(e) {
                try {
                    let data = [];
                    
                    if (fileName.endsWith('.csv')) {
                        // CSV íŒŒì¼ ì²˜ë¦¬
                        let csv = e.target.result;
                        
                        // UTF-8 BOM ì œê±°
                        if (csv.charCodeAt(0) === 0xFEFF) {
                            csv = csv.substr(1);
                        }
                        const lines = csv.split('\n');
                        
                        // í—¤ë” ê±´ë„ˆë›°ê¸°
                        for (let i = 1; i < lines.length; i++) {
                            const line = lines[i].trim();
                            if (line === '') continue;
                            
                            const parts = line.split(',');
                            if (parts.length >= 3) {
                                data.push([
                                    parts[0].trim(),
                                    parts[1].trim(),
                                    parts[2].trim()
                                ]);
                            }
                        }
                    } else {
                        // XLSX íŒŒì¼ ì²˜ë¦¬
                        const workbook = XLSX.read(e.target.result, { type: 'array' });
                        const firstSheetName = workbook.SheetNames[0];
                        const worksheet = workbook.Sheets[firstSheetName];
                        const jsonData = XLSX.utils.sheet_to_json(worksheet, { header: 1 });
                        
                        // í—¤ë” ê±´ë„ˆë›°ê¸°
                        data = jsonData.slice(1);
                    }
                    
                    // ë°ì´í„° ì²˜ë¦¬
                    let successCount = 0;
                    let errorCount = 0;
                    let errors = [];
                    
                    data.forEach((row, index) => {
                        if (row.length >= 3) {
                            const studentNumber = String(row[0]).trim();
                            const name = String(row[1]).trim();
                            const phone = String(row[2]).trim();
                            
                            if (studentNumber && name) {
                                studentData[studentNumber] = {
                                    name: name,
                                    phone: phone
                                };
                                successCount++;
                            } else {
                                errors.push(`${index + 2}í–‰: ë²ˆí˜¸ ë˜ëŠ” ì´ë¦„ì´ ëˆ„ë½ë¨`);
                                errorCount++;
                            }
                        } else if (row.some(cell => cell)) { // ë¹ˆ í–‰ì´ ì•„ë‹Œ ê²½ìš°ë§Œ
                            errors.push(`${index + 2}í–‰: í˜•ì‹ì´ ì˜¬ë°”ë¥´ì§€ ì•ŠìŒ`);
                            errorCount++;
                        }
                    });
                    
                    // ê²°ê³¼ í‘œì‹œ
                    let resultHtml = `<h4>ì—…ë¡œë“œ ê²°ê³¼</h4>`;
                    resultHtml += `<p>âœ… ì„±ê³µ: ${successCount}ëª…</p>`;
                    if (errorCount > 0) {
                        resultHtml += `<p>âŒ ì˜¤ë¥˜: ${errorCount}ê±´</p>`;
                        resultHtml += `<ul>`;
                        errors.forEach(error => {
                            resultHtml += `<li>${error}</li>`;
                        });
                        resultHtml += `</ul>`;
                    }
                    
                    resultDiv.innerHTML = resultHtml;
                    resultDiv.style.display = 'block';
                    resultDiv.style.backgroundColor = successCount > 0 ? '#d4edda' : '#f8d7da';
                    resultDiv.style.color = successCount > 0 ? '#155724' : '#721c24';
                    
                    // í•™ìƒ ë°ì´í„° ì €ì¥
                    saveStudentData();
                    
                } catch (error) {
                    resultDiv.innerHTML = `<h4>ì˜¤ë¥˜</h4><p>íŒŒì¼ì„ ì½ëŠ” ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤: ${error.message}</p>`;
                    resultDiv.style.display = 'block';
                    resultDiv.style.backgroundColor = '#f8d7da';
                    resultDiv.style.color = '#721c24';
                }
            };
            
            // íŒŒì¼ íƒ€ì…ì— ë”°ë¼ ë‹¤ë¥´ê²Œ ì½ê¸°
            if (fileName.endsWith('.csv')) {
                reader.readAsText(file, 'utf-8');
            } else {
                reader.readAsArrayBuffer(file);
            }
        }
        
        // í•™ìƒ ë°ì´í„° ì €ì¥
        function saveStudentData() {
            localStorage.setItem('student_data', JSON.stringify(studentData));
        }
        
        // í•™ìƒ ë°ì´í„° ë¶ˆëŸ¬ì˜¤ê¸°
        function loadStudentData() {
            const saved = localStorage.getItem('student_data');
            if (saved) {
                studentData = JSON.parse(saved);
            }
        }
        
        // í•™ìƒ ì •ë³´ ê°€ì ¸ì˜¤ê¸°
        function getStudentInfo(studentNumber) {
            const info = studentData[studentNumber];
            if (info) {
                return {
                    name: info.name,
                    phone: info.phone
                };
            }
            return {
                name: `í•™ìƒ${studentNumber}`,
                phone: '010-0000-0000'
            };
        }

        // í˜ì´ì§€ ë¡œë“œì‹œ ì´ˆê¸°í™”
        window.onload = function() {
            // ì‘ì—… ë‚ ì§œ ì´ˆê¸°í™” (ì˜¤ëŠ˜ì´ ì£¼ë§ì´ë©´ í‰ì¼ë¡œ ì¡°ì •)
            const today = new Date();
            if (today.getDay() === 0) { // ì¼ìš”ì¼
                workingDate.setDate(today.getDate() + 1); // ì›”ìš”ì¼ë¡œ
            } else if (today.getDay() === 6) { // í† ìš”ì¼
                workingDate.setDate(today.getDate() + 2); // ì›”ìš”ì¼ë¡œ
            }
            
            // ëª¨ë“  ë‚ ì§œ ë³€ìˆ˜ë¥¼ ë™ê¸°í™”
            currentDate = new Date(workingDate);
            selectedDate = new Date(workingDate);
            
            displayWorkingDate();
            createStudentCards();
            loadFromLocalStorage();
            loadWorkingDateData();
            createCalendar();
            
            // ì›¹í›… URL ë¶ˆëŸ¬ì˜¤ê¸°
            loadWebhookUrl();
            
            // ë¬¸ìë°œì†¡ ê¸°ë¡ ë¶ˆëŸ¬ì˜¤ê¸°
            loadSMSRecords();
            
            // í•™ìƒ ë°ì´í„° ë¶ˆëŸ¬ì˜¤ê¸°
            loadStudentData();
            
            // í…œí”Œë¦¿ ë¶ˆëŸ¬ì˜¤ê¸°
            const savedTemplate = localStorage.getItem('sms_template');
            const savedSender = localStorage.getItem('sms_sender_name');
            if (savedTemplate) smsTemplate = savedTemplate;
            if (savedSender) senderName = savedSender;
            
            // ê¸°ë³¸ìœ¼ë¡œ ì¶œê²°ê´€ë¦¬ íƒ­ í™œì„±í™”
            switchTab('attendance');
        };
        
        // ëª¨ë‹¬ ì™¸ë¶€ í´ë¦­ì‹œ ë‹«ê¸°
        window.onclick = function(event) {
            const historyModal = document.getElementById('historyModal');
            const periodModal = document.getElementById('periodModal');
            const attendanceModal = document.getElementById('attendanceModal'); // v2 ì¶”ê°€
            const monthSelectorModal = document.getElementById('monthSelectorModal'); // ì›” ì„ íƒ ëª¨ë‹¬ ì¶”ê°€
            const templateModal = document.getElementById('templateModal'); // í…œí”Œë¦¿ ëª¨ë‹¬ ì¶”ê°€
            
            if (event.target === historyModal) {
                historyModal.style.display = 'none';
            }
            
            if (event.target === periodModal) {
                closePeriodModal();
            }
            
            if (event.target === attendanceModal) {
                closeAttendanceModal();
            }
            
            if (event.target === monthSelectorModal) {
                closeMonthSelector();
            }
            
            if (event.target === templateModal) {
                closeTemplateModal();
            }
        };
    </script>
</body>
</html>
